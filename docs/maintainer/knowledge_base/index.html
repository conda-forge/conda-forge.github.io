<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-maintainer/knowledge_base" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Knowledge Base | conda-forge | community-driven packaging for conda</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://conda-forge.org/docs/maintainer/knowledge_base/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Knowledge Base | conda-forge | community-driven packaging for conda"><meta data-rh="true" name="description" content="Finding examples with Github Code Search"><meta data-rh="true" property="og:description" content="Finding examples with Github Code Search"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://conda-forge.org/docs/maintainer/knowledge_base/"><link data-rh="true" rel="alternate" href="https://conda-forge.org/docs/maintainer/knowledge_base/" hreflang="en"><link data-rh="true" rel="alternate" href="https://conda-forge.org/docs/maintainer/knowledge_base/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KB43FQOB7U-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Maintainer Documentation","item":"https://conda-forge.org/docs/maintainer/"},{"@type":"ListItem","position":2,"name":"Knowledge Base","item":"https://conda-forge.org/docs/maintainer/knowledge_base"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="conda-forge | community-driven packaging for conda RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="conda-forge | community-driven packaging for conda Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="conda-forge | community-driven packaging for conda" href="/opensearch.xml">

<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="conda-forge | community-driven packaging for conda RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="conda-forge | community-driven packaging for conda Atom Feed">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
<script src="/js/count.js" defer="defer" data-goatcounter="https://conda-forge.goatcounter.com/count"></script><link rel="stylesheet" href="/assets/css/styles.1b8e7874.css">
<script src="/assets/js/runtime~main.1802f2ec.js" defer="defer"></script>
<script src="/assets/js/main.dcfb06c1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="conda-forge anvil logo without text" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="conda-forge anvil logo without text" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/community/">Community</a><a class="navbar__item navbar__link" href="/news/">News</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/status/">Status</a><a class="navbar__item navbar__link" href="/packages/">Packages</a><a class="navbar__item navbar__link" href="/download/">Download</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://opencollective.com/conda-forge" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Donate<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/conda-forge" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fab fa-lg fa-github" title="GitHub"></a><a href="https://conda-forge.zulipchat.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fa-solid fa-comments" title="Zulip"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/"><span title="conda-forge documentation" class="linkLabel_WmDU">conda-forge documentation</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/user/"><span title="User Documentation" class="categoryLinkLabel_W154">User Documentation</span></a><button aria-label="Expand sidebar category &#x27;User Documentation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/maintainer/"><span title="Maintainer Documentation" class="categoryLinkLabel_W154">Maintainer Documentation</span></a><button aria-label="Collapse sidebar category &#x27;Maintainer Documentation&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/maintainer/infrastructure/"><span title="Infrastructure" class="linkLabel_WmDU">Infrastructure</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/maintainer/guidelines/"><span title="Guidelines" class="linkLabel_WmDU">Guidelines</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/maintainer/adding_pkgs/"><span title="Contributing packages" class="linkLabel_WmDU">Contributing packages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/maintainer/updating_pkgs/"><span title="Maintaining packages" class="linkLabel_WmDU">Maintaining packages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/maintainer/pinning_deps/"><span title="Pinned dependencies" class="linkLabel_WmDU">Pinned dependencies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/maintainer/conda_forge_yml/"><span title="Configuring conda-forge.yml" class="linkLabel_WmDU">Configuring conda-forge.yml</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/maintainer/knowledge_base/"><span title="Knowledge Base" class="linkLabel_WmDU">Knowledge Base</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/maintainer/maintainer_faq/"><span title="FAQ" class="linkLabel_WmDU">FAQ</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/maintainer/understanding_conda_forge/"><span title="Understanding conda-forge" class="categoryLinkLabel_W154">Understanding conda-forge</span></a><button aria-label="Expand sidebar category &#x27;Understanding conda-forge&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/maintainer/example_recipes/"><span title="Example recipes" class="categoryLinkLabel_W154">Example recipes</span></a><button aria-label="Expand sidebar category &#x27;Example recipes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/glossary/"><span title="Glossary" class="linkLabel_WmDU">Glossary</span></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/maintainer/"><span>Maintainer Documentation</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Knowledge Base</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p><a id="knowledge-base" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<header><h1>Knowledge Base</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="search-github">Finding examples with Github Code Search<a href="#search-github" class="hash-link" aria-label="Direct link to Finding examples with Github Code Search" title="Direct link to Finding examples with Github Code Search" translate="no">​</a></h2>
<p>Github&#x27;s <a href="https://github.com/features/code-search" target="_blank" rel="noopener noreferrer" class="">Code Search</a> is an incredibly useful tool to find examples of recipes in conda-forge.
There are a couple tricks you can use to make the most out of your searches.</p>
<ul>
<li class="">Limit the search to <code>org:conda-forge</code>.</li>
<li class="">Limit the path to the type of file you want. This usually means:
<ul>
<li class=""><code>path:meta.yaml</code> for the main metadata file.</li>
<li class=""><code>path:recipe/*.sh</code> for Unix build scripts.</li>
<li class=""><code>path:recipe/*.bat</code> for Windows build scripts.</li>
</ul>
</li>
</ul>
<p>That&#x27;s it, with those two modifiers, you can get a lot done! Some examples include:</p>
<ul>
<li class=""><a href="https://github.com/search?type=code&amp;q=org%3Aconda-forge+path%3Ameta.yaml+%22noarch%3A+python%22" target="_blank" rel="noopener noreferrer" class="">All <code>noarch: python</code> recipes</a>.</li>
<li class="">Recipes that depend on... <a href="https://github.com/search?type=code&amp;q=org%3Aconda-forge+path%3Ameta.yaml+%22-+cuda%22" target="_blank" rel="noopener noreferrer" class=""><code>cuda</code></a>, <a href="https://github.com/search?type=code&amp;q=org%3Aconda-forge+path%3Ameta.yaml+%22-+pytorch%22" target="_blank" rel="noopener noreferrer" class=""><code>pytorch</code></a>, <a href="https://github.com/search?type=code&amp;q=org%3Aconda-forge+path%3Ameta.yaml+%2F-+__%5CS%2B%2F" target="_blank" rel="noopener noreferrer" class=""><code>__virtual</code> packages</a>, etc.</li>
<li class=""><a href="https://github.com/search?type=code&amp;q=org%3Aconda-forge+cmake+path%3Arecipe%2F*.sh" target="_blank" rel="noopener noreferrer" class="">Scripts that use CMake on Unix</a>.</li>
<li class=""><a href="https://github.com/search?type=code&amp;q=org%3Aconda-forge+cmake+path%3Arecipe%2F*.bat" target="_blank" rel="noopener noreferrer" class="">Scripts that use CMake on Windows</a>.</li>
<li class=""><a href="https://github.com/search?type=code&amp;q=org%3Aconda-forge+path%3Ameta.yaml+%22target_platform+%21%3D+build_platform%22+OR+%22build_platform+%21%3D+target_platform%22" target="_blank" rel="noopener noreferrer" class="">Recipes that use cross-compilation</a>.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Configure your browser to have a search shortcut</div><div class="admonitionContent_BuS1"><p>For example, in Chrome you can go to <a href="chrome://settings/searchEngines" target="_blank" rel="noopener noreferrer" class=""><code>chrome://settings/searchEngines</code></a> and add a new entry with:</p><ul>
<li class="">Name: conda-forge recipes</li>
<li class="">Shortcut: <code>cf</code></li>
<li class="">URL: <code>https://github.com/search?type=code&amp;q=org%3Aconda-forge+%s</code></li>
</ul><p>And with that you can simply type <code>cf your-search-here</code> for super fast queries!</p></div></div>
<p><a id="using-cmake" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-cmake">Using CMake<a href="#using-cmake" class="hash-link" aria-label="Direct link to Using CMake" title="Direct link to Using CMake" translate="no">​</a></h2>
<p><a href="https://cmake.org/" target="_blank" rel="noopener noreferrer" class="">CMake</a> can be used to build more complex projects in <code>build.sh</code>
or <code>bld.bat</code> scripts.</p>
<p>If you are using cmake, be sure to make it a build requirement in the <code>build</code> section. You
may also need to include <code>make</code> or <code>ninja</code> depending on your platform and build tools.
On Windows, you can also use <code>nmake</code> to build, but that does not need to be explicitly included.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> make  </span><span class="token comment" style="color:#999988;font-style:italic"># [not win]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ninja  </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><br></span></code></pre></div></div>
<p>For CMake projects using the <a href="https://cmake.org/cmake/help/git-stage/module/FindPython.html" target="_blank" rel="noopener noreferrer" class="">FindPython</a>
module, you can tell CMake which Python to use by passing <code>-DPython_EXECUTABLE=&quot;$PYTHON&quot;</code>
(macOS or Linux) or <code>-DPython_EXECUTABLE=&quot;%PYTHON%&quot;</code> (Windows) as a command line option.
Older CMake projects may require similar, but slightly different options.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Don&#x27;t forget that depending on which CMake module you use you have to use a different command:</p><ul>
<li class=""><a href="https://cmake.org/cmake/help/git-stage/module/FindPython.html" target="_blank" rel="noopener noreferrer" class="">FindPython</a>:
<code>-DPython_EXECUTABLE=...</code>.</li>
<li class=""><a href="https://cmake.org/cmake/help/git-stage/module/FindPython3.html" target="_blank" rel="noopener noreferrer" class="">FindPython3</a>:
<code>-DPython3_EXECUTABLE=...</code>.</li>
<li class=""><a href="https://cmake.org/cmake/help/git-stage/module/FindPython2.html" target="_blank" rel="noopener noreferrer" class="">FindPython2</a>:
<code>-DPython2_EXECUTABLE=...</code>.</li>
</ul><p>or if you are still on the deprecated <a href="https://cmake.org/cmake/help/latest/module/FindPythonLibs.html" target="_blank" rel="noopener noreferrer" class="">FindPythonLibs</a>: <code>-DPYTHON_EXECUTABLE=...</code>.</p></div></div>
<p>Some optional, but useful CMake options:</p>
<ul>
<li class=""><code>-DCMAKE_BUILD_TYPE=Release</code> Configure as release build. This is better done on the initial
<code>cmake</code> call as some packages construct different build configurations depending on this flag.</li>
<li class=""><code>-DCMAKE_INSTALL_PREFIX=$PREFIX</code> Specify the install location.</li>
<li class=""><code>-DCMAKE_INSTALL_LIBDIR=lib</code> Libraries will land in $PREFIX/lib, sometimes projects install
into lib64 or similar but on conda-forge we keep shared libraries in simply lib.</li>
<li class=""><code>-DBUILD_SHARED_LIBS=ON</code> Instruct CMake to build shared libraries instead of static ones.</li>
<li class=""><code>-DCMAKE_FIND_FRAMEWORK=NEVER</code> and <code>-DCMAKE_FIND_APPBUNDLE=NEVER</code> Prevent CMake from using system-wide macOS packages.</li>
<li class=""><code>${CMAKE_ARGS}</code> Add variables defined by conda-forge internally. This is required to enable various conda-forge enhancements, like <a href="#cuda" class="">CUDA builds</a>.</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>As <code>${CMAKE_ARGS}</code> is a space separated list of options, quoting <code>${CMAKE_ARGS}</code>
(<code>&quot;${CMAKE_ARGS}&quot;</code>) in recipes can lead to build errors as quoting makes the shell
treat the contents of the variable as a single argument.</p></div></div>
<p>Here are some basic commands for you to get started. These are dependent on your source
code layout and aren&#x27;t intended to be used &quot;as is&quot;.</p>
<p><strong>CMake lines for build.sh (macOS/Linux):</strong></p>
<div class="language-default codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-default codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmake CMakeLists.txt -DPython3_EXECUTABLE=&quot;$PYTHON&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake --build . --config Release</span><br></span></code></pre></div></div>
<p><strong>CMake lines for bld.bat (Windows):</strong></p>
<div class="language-default codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-default codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmake -G &quot;NMake Makefiles&quot; -DCMAKE_BUILD_TYPE=Release -DPython3_EXECUTABLE=&quot;%PYTHON%&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if errorlevel 1 exit /b 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake --build . --config Release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if errorlevel 1 exit /b 1</span><br></span></code></pre></div></div>
<p>See also the <code>bld.bat</code> in the Windows section below for an additional example.</p>
<p>Other useful <code>cmake</code> options are <code>-B&lt;directory&gt;</code> and <code>-S&lt;directory&gt;</code> to specify build and source
directories.</p>
<p><a id="moving-from-an-autotools-build-to-a-cmake-build" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="moving-from-an-autotools-build-to-a-cmake-build">Moving from an autotools build to a CMake build<a href="#moving-from-an-autotools-build-to-a-cmake-build" class="hash-link" aria-label="Direct link to Moving from an autotools build to a CMake build" title="Direct link to Moving from an autotools build to a CMake build" translate="no">​</a></h3>
<p>Some packages maintain an autotools build and a cmake build. Some maintainers
would like to switch to a cmake build because that provides windows builds
easily. These builds are mostly not ABI compatible with each other.
Here are some things you should check,</p>
<ol>
<li class="">
<p>Check that both libraries have the same SONAME on linux</p>
<p>Run <code>readelf -d /path/to/lib.so</code></p>
</li>
<li class="">
<p>Check that both libraries have the same install name and have the same
compatibility and current versions.</p>
<p>Run <code>otool -L /path/to/lib.dylib</code>. The second line should give you
the three pieces of information</p>
</li>
<li class="">
<p>Check that the file list is the same in both.</p>
</li>
<li class="">
<p>Check that you use the same options as the same autoconf build.</p>
</li>
<li class="">
<p>Check that the symbols exported are the same.</p>
</li>
<li class="">
<p>Check that additional packaging information stays the same, e.g. is the same pkg-config information provided.</p>
</li>
</ol>
<p><a id="particularities-on-windows" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="particularities-on-windows">Particularities on Windows<a href="#particularities-on-windows" class="hash-link" aria-label="Direct link to Particularities on Windows" title="Direct link to Particularities on Windows" translate="no">​</a></h2>
<p>This document presents conda-forge and conda-build information and examples
while building on Windows.</p>
<p><a id="local-testing" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="local-testing">Local testing<a href="#local-testing" class="hash-link" aria-label="Direct link to Local testing" title="Direct link to Local testing" translate="no">​</a></h3>
<p>The first thing that you should know is that you can locally test Windows
builds of your packages even if you don&#x27;t own a Windows machine. Microsoft
makes available free, official Windows virtual machines (VMs) <a href="https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/" target="_blank" rel="noopener noreferrer" class="">at this website</a>. If you
are unfamiliar with VM systems or have trouble installing Microsoft&#x27;s VMs, please
use a general web search to explore — while these topics are beyond the
scope of this documentation, there are ample discussions on them on the broader
Internet.</p>
<p>To bootstrap a conda environment and install <code>conda-build</code>, consider
<a href="https://github.com/conda-forge/miniforge" target="_blank" rel="noopener noreferrer" class="">miniforge</a>.</p>
<p><a id="executing-a-build" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="executing-a-build">Executing a build<a href="#executing-a-build" class="hash-link" aria-label="Direct link to Executing a build" title="Direct link to Executing a build" translate="no">​</a></h4>
<p>The <code>build-locally.py</code> script does not support Windows (yet, PRs welcome!).
You can use <code>conda build recipe/ -m .ci_support/choose_your_config.yaml</code> as
a workaround for now.</p>
<p><a id="testing-a-local-build" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-a-local-build">Testing a local build<a href="#testing-a-local-build" class="hash-link" aria-label="Direct link to Testing a local build" title="Direct link to Testing a local build" translate="no">​</a></h4>
<p>Because we&#x27;re using <code>conda-build</code> directly instead of <code>build-locally.py</code>,
we can use the <code>local</code> channel:</p>
<div class="language-default codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-default codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda create -n my-new-env -c local my-package</span><br></span></code></pre></div></div>
<p><a id="testing-using-wine" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-using-wine">Testing using wine<a href="#testing-using-wine" class="hash-link" aria-label="Direct link to Testing using wine" title="Direct link to Testing using wine" translate="no">​</a></h4>
<p>Some degree of testing and debugging can also be performed without a Windows
system, using <a href="https://www.winehq.org/" target="_blank" rel="noopener noreferrer" class="">wine</a>.
<a href="https://github.com/conda-forge/miniforge" target="_blank" rel="noopener noreferrer" class="">miniforge</a> works correctly
in the wine&#x27;s <code>cmd</code> shell, and can be used to create and run Conda environments.
In fact, sometimes Wine is able to provide more insightful error messages,
for example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wine: Call from 00006FFFFFF999EA to unimplemented function libblas.dll.cdotc_, aborting</span><br></span></code></pre></div></div>
<p>It may be necessary to manipulate the <code>WINEDEBUG</code> variable to obtain more
debugging logs.</p>
<p><a id="debugging-dll-issues" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="debugging-dll-issues">Debugging DLL issues<a href="#debugging-dll-issues" class="hash-link" aria-label="Direct link to Debugging DLL issues" title="Direct link to Debugging DLL issues" translate="no">​</a></h4>
<p>When debugging issues related to dynamically-linked libraries (DLLs) failing
to load, the following tools can be helpful:</p>
<ul>
<li class="">
<p><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools" target="_blank" rel="noopener noreferrer" class="">Windows Debugger</a>
can be used when debugging the dreaded &quot;DLL load failed&quot; errors. For example to debug a numpy import error:</p>
<ul>
<li class=""><code>&quot;C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\gflags.exe&quot; -i python.exe +sls</code></li>
<li class=""><code>&quot;C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\cdb.exe&quot; -logo log.txt -g -G -o -xn av python -c &quot;import numpy&quot;</code>
The log file saved in <code>log.txt</code> will display information about where the DLLs were loaded from,
which DLLs are missing and which symbols are missing from a DLL.</li>
</ul>
</li>
<li class="">
<p><a href="https://www.dependencywalker.com/" target="_blank" rel="noopener noreferrer" class="">Dependency Walker</a> can display a tree
diagram of all dependent modules.</p>
</li>
<li class="">
<p><a href="https://github.com/lucasg/Dependencies" target="_blank" rel="noopener noreferrer" class="">Dependencies</a> is a more modern
replacement for Dependency Walker, with both console and GUI interface.
It also works better on Wine.</p>
</li>
<li class="">
<p><a href="https://learn.microsoft.com/en-us/cpp/build/reference/dumpbin-reference" target="_blank" rel="noopener noreferrer" class="">dumpbin</a>
tool from MSVC can be used to obtain information about Windows binaries.
On Unix, <a href="https://sourceforge.net/p/mingw-w64/wiki2/gendef" target="_blank" rel="noopener noreferrer" class="">gendef</a>
tool can be used instead by installing the conda package.</p>
</li>
</ul>
<p><a id="notes-on-native-code" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="notes-on-native-code">Notes on native code<a href="#notes-on-native-code" class="hash-link" aria-label="Direct link to Notes on native code" title="Direct link to Notes on native code" translate="no">​</a></h3>
<p>In order to compile native code (C, C++, etc.) on Windows, you will need to
install Microsoft&#x27;s Visual C++ build tools on your VM. You must install
particular versions of these tools — this is to maintain compatibility between
compiled libraries used in Python, <a href="https://wiki.python.org/moin/WindowsCompilers" target="_blank" rel="noopener noreferrer" class="">as described on this Python wiki page</a>. The current relevant
versions are:</p>
<ul>
<li class="">For Python 3.5–3.12+: Visual C++ 14.x</li>
</ul>
<p>While you can obtain these tools by installing the right version of the full
<a href="https://visualstudio.microsoft.com/" target="_blank" rel="noopener noreferrer" class="">Visual Studio</a> development
environment, you can save a lot of time and bandwidth by installing standalone
&quot;build tools&quot; packages. You can get them from <a href="https://visualstudio.microsoft.com/vs/older-downloads/#visual-studio-2022-and-other-products" target="_blank" rel="noopener noreferrer" class="">Visual Studio
Subscriptions</a>.
To download build tools, you&#x27;ll need a Microsoft account. Once on the
Visual Studio Subscriptions page, you may also need to join the Dev Essentials
program. Once that&#x27;s done, you can click the &quot;Download&quot; tab and search for
&quot;Build Tools for Visual Studio 2022&quot;. You can directly install VC-2022 using the
<a href="https://aka.ms/vs/17/release/vs_BuildTools.exe" target="_blank" rel="noopener noreferrer" class="">Visual Studio Build Tools 2022 installer</a>.</p>
<p>If you need more information. Please refer <a href="https://wiki.python.org/moin/WindowsCompilers" target="_blank" rel="noopener noreferrer" class="">the Python wiki page on Windows compilers</a>.</p>
<p><a id="simple-cmake-based-bld-bat" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="simple-cmake-based-bldbat">Simple CMake-Based <code>bld.bat</code><a href="#simple-cmake-based-bldbat" class="hash-link" aria-label="Direct link to simple-cmake-based-bldbat" title="Direct link to simple-cmake-based-bldbat" translate="no">​</a></h4>
<p>Some projects provide hooks for CMake to build the project. The following
example <code>bld.bat</code> file demonstrates how to build a traditional, out-of-core
build for such projects.</p>
<p><strong>CMake-based bld.bat:</strong></p>
<div class="language-batch codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-batch codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token command keyword" style="color:#00009f">setlocal</span><span class="token command"> EnableDelayedExpansion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">:: Make a build folder and change to it.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command keyword" style="color:#00009f">mkdir</span><span class="token command"> build</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command keyword" style="color:#00009f">cd</span><span class="token command"> build</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">:: Configure using the CMakeFiles</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command keyword" style="color:#00009f">cmake</span><span class="token command"> </span><span class="token command parameter attr-name" style="color:#00a4db">-G</span><span class="token command"> </span><span class="token command string" style="color:#e3116c">&quot;NMake Makefiles&quot;</span><span class="token command"> </span><span class="token command operator" style="color:#393A34">^</span><span class="token command"></span><br></span><span class="token-line" style="color:#393A34"><span class="token command">      -DCMAKE_INSTALL_PREFIX:PATH=</span><span class="token command string" style="color:#e3116c">&quot;%LIBRARY_PREFIX%&quot;</span><span class="token command"> </span><span class="token command operator" style="color:#393A34">^</span><span class="token command"></span><br></span><span class="token-line" style="color:#393A34"><span class="token command">      -DCMAKE_PREFIX_PATH:PATH=</span><span class="token command string" style="color:#e3116c">&quot;%LIBRARY_PREFIX%&quot;</span><span class="token command"> </span><span class="token command operator" style="color:#393A34">^</span><span class="token command"></span><br></span><span class="token-line" style="color:#393A34"><span class="token command">      -DCMAKE_BUILD_TYPE:STRING=Release </span><span class="token command operator" style="color:#393A34">^</span><span class="token command"></span><br></span><span class="token-line" style="color:#393A34"><span class="token command">      ..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command keyword" style="color:#00009f">if</span><span class="token command"> </span><span class="token command keyword" style="color:#00009f">errorlevel</span><span class="token command"> </span><span class="token command number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token command keyword" style="color:#00009f">exit</span><span class="token command"> </span><span class="token command number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">:: Build!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command keyword" style="color:#00009f">nmake</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command keyword" style="color:#00009f">if</span><span class="token command"> </span><span class="token command keyword" style="color:#00009f">errorlevel</span><span class="token command"> </span><span class="token command number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token command keyword" style="color:#00009f">exit</span><span class="token command"> </span><span class="token command number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">:: Install!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command keyword" style="color:#00009f">nmake</span><span class="token command"> install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command keyword" style="color:#00009f">if</span><span class="token command"> </span><span class="token command keyword" style="color:#00009f">errorlevel</span><span class="token command"> </span><span class="token command number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token command keyword" style="color:#00009f">exit</span><span class="token command"> </span><span class="token command number" style="color:#36acaa">1</span><br></span></code></pre></div></div>
<p>The following feedstocks are examples of this build structure deployed:</p>
<ul>
<li class=""><a href="https://github.com/conda-forge/libpng-feedstock/blob/main/recipe/build.bat" target="_blank" rel="noopener noreferrer" class="">libpng</a></li>
<li class=""><a href="https://github.com/conda-forge/pugixml-feedstock/blob/main/recipe/bld.bat" target="_blank" rel="noopener noreferrer" class="">Pugixml</a></li>
</ul>
<p><a id="building-for-different-vc-versions" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="versions-of-microsoft-visual-c-msvc">Versions of Microsoft Visual C++ (MSVC)<a href="#versions-of-microsoft-visual-c-msvc" class="hash-link" aria-label="Direct link to Versions of Microsoft Visual C++ (MSVC)" title="Direct link to Versions of Microsoft Visual C++ (MSVC)" translate="no">​</a></h4>
<p>Up until Visual Studio (VS) 2013, the MSVC compiler changed ABI on every major release,
meaning packages that communicated through a C/C++ API had to be built with a consistent
version. This meant for example that python 2.7 required <code>vs2008</code> for the duration of its lifetime.</p>
<p>Since VS2015, the ABI has been kept stable though, meaning that packages do not have to be
built with the same MSVC version. This allows us to avoid complicated migrations for ~all
compiled packages, or getting stuck on old compiler versions.</p>
<p>Speaking of versions, the situation with MSVC can be very confusing. The Visual Studio year is
often used as a shorthand for the compiler generation, but what&#x27;s really relevant is the
toolchain version, which, since VS2015 has been 14.x, and which is referred to as <code>vc</code>.</p>








































<table><thead><tr><th>VS Year</th><th>VS Version</th><th>Compiler Version</th><th>Toolchain Version</th><th>Runtime Version</th></tr></thead><tbody><tr><td>2015</td><td>14.0</td><td>19.0</td><td>14.0</td><td>14.0.zzzzz</td></tr><tr><td>2017</td><td>15.x</td><td>19.1y</td><td>14.1</td><td>14.1y.zzzzz</td></tr><tr><td>2019</td><td>16.x</td><td>19.2x</td><td>14.2</td><td>14.2x.zzzzz</td></tr><tr><td>2022</td><td>17.x</td><td>19.3x</td><td>14.3</td><td>14.3x.zzzzz</td></tr></tbody></table>
<p>In the table above, <code>x</code> and <code>y</code> on the same line are referring to the same digit, though there
are various deviations from this schema. For example, the minor versions for the 2022 line went
beyond 9, so 17.14 corresponds to compiler 19.44 (30+14) and runtime 14.44.</p>
<p>We are always able to use the newest runtime in an environment, so we always satisfy the respective
lower bound imposed by the compiler version. However, there are other situations where the toolchain
version becomes &quot;viral&quot;, in the sense that certain artefacts like static libraries have to be
consumed by a toolchain that&#x27;s at least as new as the one that produced it. We therefore try to
not raise our default compiler version too quickly.</p>
<p>As of June 2025, we are now on the most recent VS2022 (because VS2019 had reached end-of-life already
in mid 2024), though the next major version of Visual Studio is already on the horizon. It will
still be ABI-compatible, such that we will not have to rebuild everything. In other words, the
toolchain version will remain <code>14.x</code>.</p>
<p>If the day ever comes where MSVC breaks the ABI again (codename &quot;vNext&quot;), then we will have to rebuild
all compiled packages in conda-forge on windows. After such a migration has taken place, you can then
choose to skip building for one or the other by using <code>vc</code> in a selector, e.g.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># to demonstrate mechanism: only build vNext</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">skip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [win and vc&lt;15]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> compiler(&#x27;cxx&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><a id="using-vs2022" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-newer-msvc-versions">Using newer MSVC versions<a href="#using-newer-msvc-versions" class="hash-link" aria-label="Direct link to Using newer MSVC versions" title="Direct link to Using newer MSVC versions" translate="no">​</a></h4>
<p>Given that conda-forge is currently (June 2025) on the latest VS line, it&#x27;s currently not possible
to use even newer versions. However, we expect a new Visual Studio major version within the next year
or so, and once it becomes available in the runner-images for Azure Pipelines and then in conda-forge,
it will be possible to opt into newer compilers (e.g. for C++23 support) as follows.</p>
<p>In <code>recipe/conda_build_config.yaml</code> file:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># note: future VS version is speculative!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">c_compiler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> vs2026       </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">cxx_compiler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> vs2026       </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><br></span></code></pre></div></div>
<p>After making these changes don&#x27;t forget to rerender with <code>conda-smithy</code> (to rerender manually use <code>conda smithy rerender</code> from the command line).</p>
<p><a id="cmd-batch-syntax" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="tips-tricks-for-cmd-batch-syntax" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tips--tricks-for-cmdbatch-syntax">Tips &amp; tricks for CMD/Batch syntax<a href="#tips--tricks-for-cmdbatch-syntax" class="hash-link" aria-label="Direct link to Tips &amp; tricks for CMD/Batch syntax" title="Direct link to Tips &amp; tricks for CMD/Batch syntax" translate="no">​</a></h3>
<p>Windows recipes rely on CMD/Batch scripts (<code>.bat</code>) by default.
Batch syntax is a bit different from Bash and friends on Unix, so we have collected some tips here to help you get started if you are not familiar with this scripting language.</p>
<ul>
<li class="">Check if you need to write a Batch script first!
Simple recipes might not need shell-specific code and can be written in an agnostic way.
Use the <code>build.script</code> item in <code>meta.yaml</code> (see <a href="https://docs.conda.io/projects/conda-build/en/stable/resources/define-metadata.html#script" target="_blank" rel="noopener noreferrer" class="">conda-build docs</a>).
This item can take a string or a list of strings (one per line).</li>
<li class=""><a href="https://ss64.com/nt/syntax.html" target="_blank" rel="noopener noreferrer" class="">SS64&#x27;s CMD howto pages</a> are the best resource for any kind of question regarding CMD/Batch syntax.</li>
<li class="">Search conda-forge for existing <code>.bat</code> scripts and learn with examples.
See this <a href="https://github.com/search?q=org%3Aconda-forge+language%3ABatchfile&amp;type=code&amp;l=Batchfile" target="_blank" rel="noopener noreferrer" class="">example query for all Batchfiles</a>.</li>
<li class="">You can <a href="https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/" target="_blank" rel="noopener noreferrer" class="">free trial Windows VMs from Microsoft</a>.
Set one up with your favorite virtualization solution to debug your CMD syntax.
There are also some minimal emulators online that might get you started with the basics, even if not all CMD features are present.
For example, this <a href="https://www.pcjs.org/software/pcx86/sys/windows/win95/4.00.950/" target="_blank" rel="noopener noreferrer" class="">Windows 95 emulator</a> features a more or less okay MS-DOS prompt.</li>
</ul>
<p><a id="building-packages-using-configure-scripts-written-in-shell-script" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="building-packages-using-configure-scripts-written-in-shell-script">Building packages using configure scripts written in shell script<a href="#building-packages-using-configure-scripts-written-in-shell-script" class="hash-link" aria-label="Direct link to Building packages using configure scripts written in shell script" title="Direct link to Building packages using configure scripts written in shell script" translate="no">​</a></h3>
<p>Some packages do not provide build systems with first-hand support for Windows, in particular these using <code>configure</code> scripts using autotools, or hand-written in shell scripts.
You can use the <a href="https://github.com/conda-forge/autotools_clang_conda-feedstock?tab=readme-ov-file#about-autotools_clang_conda-feedstock" target="_blank" rel="noopener noreferrer" class="">autotools_clang_conda</a> to provide a build environment with a set of MSYS2 packages and a Clang toolchain configured to build packages compatible with MSVC.
The feedstock&#x27;s description provides example instructions.</p>
<p><a id="install-paths-and-naming-conventions" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="install-paths-and-naming-conventions">Install paths and naming conventions<a href="#install-paths-and-naming-conventions" class="hash-link" aria-label="Direct link to Install paths and naming conventions" title="Direct link to Install paths and naming conventions" translate="no">​</a></h3>
<p>Unix-style packages in conda-forge are installed into a special <code>Library</code> directory tree under the build prefix.
For the convenience of writing build scripts, both conda-build and rattler-build define the following variables:</p>



































<table><thead><tr><th>Variable</th><th>Value</th><th>Use</th></tr></thead><tbody><tr><td><code>LIBRARY_PREFIX</code></td><td><code>%PREFIX%\Library</code></td><td>Prefix for installing packages</td></tr><tr><td><code>LIBRARY_BIN</code></td><td><code>%PREFIX%\Library\bin</code></td><td>Executables and DLL libraries (<code>.exe</code> and <code>.dll</code> files)</td></tr><tr><td><code>LIBRARY_INC</code></td><td><code>%PREFIX%\Library\include</code></td><td>Header files</td></tr><tr><td><code>LIBRARY_LIB</code></td><td><code>%PREFIX%\Library\lib</code></td><td>Import and static libraries (<code>.lib</code> files)</td></tr><tr><td><code>SCRIPTS</code></td><td><code>%PREFIX%\Scripts</code></td><td>Python scripts</td></tr></tbody></table>
<p>On Windows, it is not possible to link directly to dynamic libraries (<code>.dll</code> files); the linker needs to use so-called import libraries instead.
Import libraries have the same format and generally use the same suffix (<code>.lib</code>) as static libraries.
Therefore, whenever both dynamic and static libraries are installed, the import library and the static library must use different names.
There are two main naming conventions for installing libraries on Windows: the MSVC convention and the GCC/MinGW convention.</p>
<p>The MSVC convention uses the following names:</p>
<ul>
<li class="">dynamic library: <code>{name}.dll</code> (e.g. <code>zlib.dll</code>)</li>
<li class="">import library: <code>{name}.lib</code> (e.g. <code>zlib.lib</code>)</li>
<li class="">static library: no standard convention, often <code>lib{name}.lib</code> or <code>{name}-static.lib</code> (e.g. <code>zlibstatic.lib</code>)</li>
</ul>
<p>Usually, <code>{name}</code> does not include a <code>lib</code> prefix.
Following this convention ensures that <code>-l{name}</code> works for dynamic linking, same as on Unix.
However, some packages do use <code>lib</code> prefix for historical reasons, e.g. <code>libprotobuf.dll</code> + <code>libprotobuf.lib</code>.</p>
<p>The GCC/MinGW convention uses the following names:</p>
<ul>
<li class="">dynamic library: <code>lib{name}.dll</code></li>
<li class="">import library: <code>lib{name}.dll.a</code></li>
<li class="">static library: <code>lib{name}.a</code></li>
</ul>
<p>There is no standard convention for providing SONAME-style versioning for libraries.
Some packages do not provide versioning at all, others embed the version into the <code>.dll</code> name (but not the import library name, to preserve <code>-l{name}</code> behavior).</p>
<p><a id="special-dependencies-and-packages" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="special-dependencies-and-packages">Special Dependencies and Packages<a href="#special-dependencies-and-packages" class="hash-link" aria-label="Direct link to Special Dependencies and Packages" title="Direct link to Special Dependencies and Packages" translate="no">​</a></h2>
<p><a id="dep-compilers" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="compilers" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="compilers">Compilers<a href="#compilers" class="hash-link" aria-label="Direct link to Compilers" title="Direct link to Compilers" translate="no">​</a></h3>
<p>Dependencies on compilers are explained in detail in <a class="" href="/docs/maintainer/infrastructure/#compilers-and-runtimes">Compilers and Runtimes</a> infrastructure documentation.</p>
<p><a id="cross-compilation" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="id1" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cross-compilation">Cross-compilation<a href="#cross-compilation" class="hash-link" aria-label="Direct link to Cross-compilation" title="Direct link to Cross-compilation" translate="no">​</a></h3>
<p>conda-forge defaults to native builds of packages for x86_64 on Linux, macOS and Windows, because
that&#x27;s the architecture powering the default CI runners. Other architectures are supported too,
but they are not guaranteed to have native builds. In those platforms where we can&#x27;t provide native
CI runners, we can still resort to either cross-compilation or emulation.</p>
<p>Cross-compiling means building a package for a different architecture than the one the build process
is running on. Given how abundant x86_64 runners are, most common cross-compilation setups will target
non-x86_64 architectures from x86_64 runners.</p>
<p>Cross-compilation terminology usually distinguishes between two types of machine:</p>
<ul>
<li class="">Build: The machine running the building process.</li>
<li class="">Host: The machine we are building packages for.</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Some cross-compilation documentation might also distinguish between a third type of machine, the
target machine. You can read more about it in <a href="https://stackoverflow.com/questions/47010422/cross-compilation-terminologies-build-host-and-target" target="_blank" rel="noopener noreferrer" class="">this Stack Overflow question</a>.
For the purposes of conda-forge, we&#x27;ll consider the target machine to be the same as the host.</p></div></div>
<p><a id="cross-compilation-howto" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="how-to-enable-cross-compilation" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-enable-cross-compilation">How to enable cross-compilation<a href="#how-to-enable-cross-compilation" class="hash-link" aria-label="Direct link to How to enable cross-compilation" title="Direct link to How to enable cross-compilation" translate="no">​</a></h4>
<p>Cross-compilation settings depend on the <code>build_platform</code> and <code>target_platform</code> conda-build
variables:</p>
<ul>
<li class=""><code>build_platform</code>: The platform on which <code>conda-build</code> is running, which defines the <code>build</code>
environment in <code>$BUILD_PREFIX</code>.</li>
<li class=""><code>target_platform</code>: The platform on which the package will be installed. Defines the platform of
the <code>host</code> environment in <code>$PREFIX</code>. Defaults to the value of <code>build_platform</code>.</li>
</ul>
<p>To change the value of <code>target_platform</code> and enable cross-compilation, you must use
the <a class="" href="/docs/maintainer/conda_forge_yml/#build-platform">build_platform</a> mapping in <code>conda-forge.yml</code> and then <a class="" href="/docs/maintainer/updating_pkgs/#dev-update-rerender">rerender</a> the feedstock. This will generate the appropriate CI workflows and
conda-build input metadata. See also <a class="" href="/docs/maintainer/conda_forge_yml/#test">test</a> for how to skip the test phase when
cross-compiling. Provided the requirements metadata and build scripts are written correctly, the
package should just work. However, in some cases, it&#x27;ll need some adjustments; see examples below
for some common cases.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The <code>build_platform</code> and <code>target_platform</code> variables are exposed as environment variables in
the build scripts (e.g. <code>$build_platform</code>), and also as Jinja variables in the <code>meta.yaml</code>
selectors (e.g. <code># [build_platform != target_platform]</code>).</p></div></div>
<p>In addition to these two variables, there are some more environment variables that are set by
conda-forge&#x27;s automation (e.g. <code>conda-forge-ci-setup</code>, compiler activation packages, etc) that
can aid in cross-compilation setups:</p>
<ul>
<li class=""><code>CONDA_BUILD_CROSS_COMPILATION</code>: set to <code>1</code> when <code>build_platform</code> and <code>target_platform</code>
differ.</li>
<li class=""><code>CONDA_TOOLCHAIN_BUILD</code>: the autoconf triplet expected for build platform.</li>
<li class=""><code>CONDA_TOOLCHAIN_HOST</code>: the autoconf triplet expected for host platform.</li>
<li class=""><code>CMAKE_ARGS</code>: arguments needed to cross-compile with CMake. Pass it to <code>cmake</code> in your build
script.</li>
<li class=""><code>MESON_ARGS</code>: arguments needed to cross-compile with Meson. Pass it to <code>meson</code> in your build
script. Note a <a href="https://mesonbuild.com/Cross-compilation.html" target="_blank" rel="noopener noreferrer" class="">cross build definition file</a> is
automatically created for you too.</li>
<li class=""><code>CC_FOR_BUILD</code>: C compilers targeting the build platform.</li>
<li class=""><code>CXX_FOR_BUILD</code>: C++ compilers targeting the build platform.</li>
<li class=""><code>CROSSCOMPILING_EMULATOR</code>: Path to the <code>qemu</code> binary for the host platform. Useful for running
tests when cross-compiling.</li>
</ul>
<p>This is all supported by two main conda-build features introduced in version 3:</p>
<ul>
<li class="">How <a href="https://docs.conda.io/projects/conda-build/en/latest/resources/define-metadata.html#requirements-section" target="_blank" rel="noopener noreferrer" class="">requirements metadata</a>
is expressed in <code>meta.yaml</code>, which distinguishes between <code>build</code> and <code>host</code> platforms.</li>
<li class="">The <code>compiler()</code> Jinja function and underlying <a href="https://docs.conda.io/projects/conda-build/en/latest/resources/compiler-tools.html" target="_blank" rel="noopener noreferrer" class="">conventions for the compiler packages</a>.</li>
</ul>
<p><a id="placing-requirements-in-build-or-host" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="placing-requirements-in-build-or-host">Placing requirements in build or host<a href="#placing-requirements-in-build-or-host" class="hash-link" aria-label="Direct link to Placing requirements in build or host" title="Direct link to Placing requirements in build or host" translate="no">​</a></h4>
<p>The rule of the thumb is:</p>
<ul>
<li class="">If it needs to run during the build, it goes in <code>build</code>.</li>
<li class="">If it needs to be available on the target host, it goes in <code>host</code>.</li>
<li class="">If both conditions are true, it belongs in both.</li>
</ul>
<p>However, there are some exceptions to this rule; most notably Python cross-compilation
(<a href="#python-cross-compilation" class="">see below</a>).</p>
<p><a id="cross-compilation-examples" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="cross-compilation-examples">Cross-compilation examples<a href="#cross-compilation-examples" class="hash-link" aria-label="Direct link to Cross-compilation examples" title="Direct link to Cross-compilation examples" translate="no">​</a></h4>
<p>A package needs to make a few changes in their recipe to be compatible with cross-compilation. Here
are a few examples.</p>
<p>A simple C library using autotools for cross-compilation might look like this:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> compiler(&quot;c&quot;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pkg</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> gnuconfig</span><br></span></code></pre></div></div>
<p>In the build script, it would need to update the config files and guard any tests when
cross-compiling:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Get an updated config.sub and config.guess</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$BUILD_PREFIX</span><span class="token plain">/share/gnuconfig/config.* </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Skip ``make check`` when cross-compiling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${CONDA_BUILD_CROSS_COMPILATION</span><span class="token string variable operator" style="color:#393A34">:-</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${CROSSCOMPILING_EMULATOR</span><span class="token string variable operator" style="color:#393A34">:-</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre></div></div>
<p>A simple C++ library using CMake for cross-compilation might look like this:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> compiler(&quot;cxx&quot;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> make</span><br></span></code></pre></div></div>
<p>In the build script, it would need to update <code>cmake</code> call and guard any tests when cross-compiling:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Pass ``CMAKE_ARGS`` to ``cmake``</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake </span><span class="token variable" style="color:#36acaa">${CMAKE_ARGS}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Skip ``ctest`` when cross-compiling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${CONDA_BUILD_CROSS_COMPILATION</span><span class="token string variable operator" style="color:#393A34">:-</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${CROSSCOMPILING_EMULATOR</span><span class="token string variable operator" style="color:#393A34">:-</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ctest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre></div></div>
<p>Similarly, with Meson, the <code>meta.yaml</code> needs:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> compiler(&quot;c&quot;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> compiler(&quot;cxx&quot;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> meson</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> make</span><br></span></code></pre></div></div>
<p>And this in <code>build.sh</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Pass ``MESON_ARGS`` to ``meson``</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meson </span><span class="token variable" style="color:#36acaa">${MESON_ARGS}</span><span class="token plain"> builddir/</span><br></span></code></pre></div></div>
<p>A simple Python extension using Cython and NumPy&#x27;s C API would look like so:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> compiler(&quot;c&quot;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cross</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">python_</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> target_platform </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># [build_platform != target_platform]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python                                </span><span class="token comment" style="color:#999988;font-style:italic"># [build_platform != target_platform]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cython                                </span><span class="token comment" style="color:#999988;font-style:italic"># [build_platform != target_platform]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> numpy                                 </span><span class="token comment" style="color:#999988;font-style:italic"># [build_platform != target_platform]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cython</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> numpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python</span><br></span></code></pre></div></div>
<p>For more details about numpy see the dedicated <a href="#building-against-numpy" class="">section</a>.</p>
<p>With MPI, openmpi is required for the build platform as the compiler wrappers are binaries, but mpich is not required as the compiler wrappers are scripts (see <a href="https://github.com/conda-forge/mpi4py-feedstock/blob/743d379c4a04/recipe/meta.yaml#L37" target="_blank" rel="noopener noreferrer" class="">example</a>):</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">                             </span><span class="token comment" style="color:#999988;font-style:italic"># [build_platform != target_platform and mpi == &quot;openmpi&quot;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>In the build script, openmpi compiler wrappers can use host libraries by setting the environmental variable <code>OPAL_PREFIX</code> to <code>$PREFIX</code>.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$CONDA_BUILD_CROSS_COMPILATION</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${mpi}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;openmpi&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">OPAL_PREFIX</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$PREFIX</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre></div></div>
<p>There are more variations of this approach in the wild. So this is not meant to be exhaustive,
but merely to provide a starting point with some guidelines. Please look at <a href="https://github.com/search?q=org%3Aconda-forge+path%3Arecipe%2Fmeta.yaml+%22%5Bbuild_platform+%21%3D+target_platform%5D%22&amp;type=code" target="_blank" rel="noopener noreferrer" class="">other recipes for more examples</a>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="finding-numpy-in-cross-compiled-python-packages-using-cmake">Finding NumPy in cross-compiled Python packages using CMake<a href="#finding-numpy-in-cross-compiled-python-packages-using-cmake" class="hash-link" aria-label="Direct link to Finding NumPy in cross-compiled Python packages using CMake" title="Direct link to Finding NumPy in cross-compiled Python packages using CMake" translate="no">​</a></h4>
<p>If you are building a Python extension via CMake with NumPy and you want it work in cross-compilation, you need to prepend to the CMake invocation in your build script the following lines:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">Python_INCLUDE_DIR</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">python </span><span class="token string variable parameter variable" style="color:#36acaa">-c</span><span class="token string variable" style="color:#36acaa"> &#x27;import sysconfig</span><span class="token string variable punctuation" style="color:#393A34">;</span><span class="token string variable" style="color:#36acaa"> print</span><span class="token string variable punctuation" style="color:#393A34">(</span><span class="token string variable" style="color:#36acaa">sysconfig.get_path</span><span class="token string variable punctuation" style="color:#393A34">(</span><span class="token string variable string" style="color:#e3116c">&quot;include&quot;</span><span class="token string variable punctuation" style="color:#393A34">)</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&#x27;)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Python_NumPy_INCLUDE_DIR</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">python </span><span class="token string variable parameter variable" style="color:#36acaa">-c</span><span class="token string variable" style="color:#36acaa"> &#x27;import numpy</span><span class="token string variable punctuation" style="color:#393A34">;</span><span class="token string variable" style="color:#36acaa">print</span><span class="token string variable punctuation" style="color:#393A34">(</span><span class="token string variable" style="color:#36acaa">numpy.get_include</span><span class="token string variable punctuation" style="color:#393A34">(</span><span class="token string variable punctuation" style="color:#393A34">)</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&#x27;)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CMAKE_ARGS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${CMAKE_ARGS}</span><span class="token string" style="color:#e3116c"> -DPython_EXECUTABLE:PATH=</span><span class="token string variable" style="color:#36acaa">${PYTHON}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CMAKE_ARGS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${CMAKE_ARGS}</span><span class="token string" style="color:#e3116c"> -DPython_INCLUDE_DIR:PATH=</span><span class="token string variable" style="color:#36acaa">${Python_INCLUDE_DIR}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CMAKE_ARGS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${CMAKE_ARGS}</span><span class="token string" style="color:#e3116c"> -DPython_NumPy_INCLUDE_DIR=</span><span class="token string variable" style="color:#36acaa">${Python_NumPy_INCLUDE_DIR}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CMAKE_ARGS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${CMAKE_ARGS}</span><span class="token string" style="color:#e3116c"> -DPython3_EXECUTABLE:PATH=</span><span class="token string variable" style="color:#36acaa">${PYTHON}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CMAKE_ARGS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${CMAKE_ARGS}</span><span class="token string" style="color:#e3116c"> -DPython3_INCLUDE_DIR:PATH=</span><span class="token string variable" style="color:#36acaa">${Python_INCLUDE_DIR}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CMAKE_ARGS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${CMAKE_ARGS}</span><span class="token string" style="color:#e3116c"> -DPython3_NumPy_INCLUDE_DIR=</span><span class="token string variable" style="color:#36acaa">${Python_NumPy_INCLUDE_DIR}</span><span class="token string" style="color:#e3116c">&quot;</span><br></span></code></pre></div></div>
<p><a id="python-cross-compilation" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="details-about-cross-compiled-python-packages" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="details-about-cross-compiled-python-packages">Details about cross-compiled Python packages<a href="#details-about-cross-compiled-python-packages" class="hash-link" aria-label="Direct link to Details about cross-compiled Python packages" title="Direct link to Details about cross-compiled Python packages" translate="no">​</a></h4>
<p>Cross-compiling Python packages is a bit more involved than other packages. The main pain point is
that we need an executable Python interpreter (i.e. <code>python</code> in <code>build</code>) that knows how to
provide accurate information about the target platform. Since this is not officially supported, a
series of workarounds are required to make it work. Refer to <a href="https://peps.python.org/pep-0720/" target="_blank" rel="noopener noreferrer" class="">PEP720</a> or <a href="https://github.com/conda-forge/conda-forge.github.io/issues/1841" target="_blank" rel="noopener noreferrer" class="">the discussion in this issue</a> for more information.</p>
<p>In practical terms, for conda-forge, this results into two extra metadata bits that are needed in
<code>meta.yaml</code>:</p>
<ul>
<li class="">Adding <code>cross-python_{{ target_platform }}</code> in <code>build</code> requirements, provided by the
<a href="https://github.com/conda-forge/cross-python-feedstock" target="_blank" rel="noopener noreferrer" class="">cross-python-feedstock</a>. This is a
wrapper for the <code>crossenv</code> Python interpreters with <a href="https://github.com/conda-forge/cross-python-feedstock/blob/main/recipe/activate-cross-python.sh" target="_blank" rel="noopener noreferrer" class="">some activation logic that adjust some of
the crossenv workarounds</a>
so they work better with the conda-build setup.</li>
<li class="">Copying some Python-related packages from <code>host</code> to <code>build</code> with a <code>[build_platform != target_platform]</code> selector:
<ul>
<li class=""><code>python</code> itself, to support <code>crossenv</code>.</li>
<li class="">Non-pure Python packages (i.e. they ship compiled libraries) that need to be present while the
package is being built, like <code>cython</code> and <code>numpy</code>.</li>
</ul>
</li>
</ul>
<p>In the terms of the <a href="https://peps.python.org/pep-0720/" target="_blank" rel="noopener noreferrer" class="">PEP720</a>, the conda-forge setup
implements the &quot;faking the target environment&quot; approach. More specifically, this will result in the
following changes before the builds scripts run:</p>
<ul>
<li class="">A modified <code>crossenv</code> installation in <code>$BUILD_PREFIX/venv</code>, mimicking the architecture of
<code>$PREFIX</code>.</li>
<li class="">Forwarder binaries in <code>$BUILD_PREFIX/bin</code> that point to the <code>crossenv</code> installation.</li>
<li class="">Symlinks that expose the <code>$BUILD_PREFIX</code> site-packages in the <code>crossenv</code> installation, which
is also included in <code>$PYTHONPATH</code>.</li>
<li class="">A copy of all <code>$PREFIX</code> site-packages to <code>$BUILD_PREFIX</code> (except the compiled libraries).</li>
</ul>
<p>All in all, this results in a setup where <code>conda-build</code> can run a <code>$BUILD_PREFIX</code>-architecture
<code>python</code> interpreter that can see the packages in <code>$PREFIX</code> (with the compiled bits provided by
their corresponding counterparts in <code>$BUILD_PREFIX</code>) and sufficiently mimic that target
architecture.</p>
<p><a id="emulation" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="emulated-builds" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="emulated-builds">Emulated builds<a href="#emulated-builds" class="hash-link" aria-label="Direct link to Emulated builds" title="Direct link to Emulated builds" translate="no">​</a></h3>
<p>When cross-compilation is not possible, one can resort to emulation. This is a technique that uses
a virtual machine (<a href="https://www.qemu.org/" target="_blank" rel="noopener noreferrer" class="">QEMU</a>) to emulate the target platform, which has a
significant overhead. However, <code>conda-build</code> will see the target platform as native, so very
little changes are usually needed in the recipe.</p>
<p>To enable emulated builds, you must use the <a class="" href="/docs/maintainer/conda_forge_yml/#provider">provider</a> mapping in <code>conda-forge.yml</code>.
This key maps a <code>build_platform</code> to a <code>provider</code> that will be used to emulate the platform.
<code>conda-smithy</code> will know how to detect whether the provider supports that platform natively or
requires emulation, and will adjust the appropriate CI steps to ensure that QEMU runs the process.
Ensure changes are applied by <a class="" href="/docs/maintainer/updating_pkgs/#dev-update-rerender">rerendering</a> the feedstock.</p>
<p>Note that only Linux architectures are currently supported via emulation.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Emulated builds are very slow and incur an additional strain on conda-forge CI resources.
Whenever possible, please consider cross-compilation instead. Only use emulated builds as a last
resort.</p></div></div>
<p><a id="emulation-examples" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="emulation-examples">Emulation examples<a href="#emulation-examples" class="hash-link" aria-label="Direct link to Emulation examples" title="Direct link to Emulation examples" translate="no">​</a></h4>
<p>Configure <code>conda-forge.yml</code> to emulate <code>linux-ppc64le</code> and <code>linux-aarch64</code>,
but use native runners for <code>linux-64</code>. This works because <code>linux-ppc64le</code>
and <code>linux-aarch64</code> are not natively supported by Azure, so
<code>conda-smithy</code> will add QEMU steps to emulate it. However, <code>linux-64</code> is
natively supported by Azure, so no emulation is needed.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">linux_aarch64</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> azure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">linux_ppc64le</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> azure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">linux_64</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> azure</span><br></span></code></pre></div></div>
<p><a id="rust-nightly" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="rust-nightly">Rust Nightly<a href="#rust-nightly" class="hash-link" aria-label="Direct link to Rust Nightly" title="Direct link to Rust Nightly" translate="no">​</a></h3>
<p>Many rust packages rely on nightly versions of the rust compiler. Given this fast release cadence, conda-forge does not yet pull each release.
Instead, rust nightly versions are pulled into the <code>dev</code> branch of the <a href="https://github.com/conda-forge/rust-feedstock/tree/dev" target="_blank" rel="noopener noreferrer" class="">conda-forge/rust-feedstock</a> on an as-needed basis.
For a new version, please file an issue on that feedstock.</p>
<p>To enable the rust nightly compiler in your feedstock, follow the section above and then add the <code>rust_dev</code> channel in the <code>conda_build_config.yaml</code> file:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">channel_sources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge/label/rust_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge</span><br></span></code></pre></div></div>
<p><a id="cdt-packages" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="core-dependency-tree-packages-cdts" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="core-dependency-tree-packages-cdts">Core Dependency Tree Packages (CDTs)<a href="#core-dependency-tree-packages-cdts" class="hash-link" aria-label="Direct link to Core Dependency Tree Packages (CDTs)" title="Direct link to Core Dependency Tree Packages (CDTs)" translate="no">​</a></h3>
<p>Dependencies outside of the <code>conda-forge</code> channel should be avoided (see <a class="" href="/docs/maintainer/adding_pkgs/#no-external-deps">Avoid external dependencies</a>).
However, there are a few exceptions:</p>
<p>Some dependencies are so close to the system that they are not packaged with conda-forge.
These dependencies have to be satisfied with <em>Core Dependency Tree</em> (CDT) packages.</p>
<p>A CDT package consists of repackaged CentOS/AlmaLinux binaries from the appropriate version,
either 7, 8 or 9 depending on user choice and platform. We manage the build of CDT
packages using a centralized repo, <a href="https://github.com/conda-forge/cdt-builds" target="_blank" rel="noopener noreferrer" class="">conda-forge/cdt-builds</a>,
as opposed to generating feedstocks for them. (Note that historically we did use feedstocks but this
practice has been deprecated). To add a new CDT, make a PR on the
<a href="https://github.com/conda-forge/cdt-builds" target="_blank" rel="noopener noreferrer" class="">conda-forge/cdt-builds</a> repo.</p>
<p><a id="why-are-cdts-bad" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-are-cdts-bad">Why are CDTs bad?<a href="#why-are-cdts-bad" class="hash-link" aria-label="Direct link to Why are CDTs bad?" title="Direct link to Why are CDTs bad?" translate="no">​</a></h4>
<ol>
<li class="">CDTs repackage old versions of the library.</li>
<li class="">As a result, newer functionality in the packages won&#x27;t be used by downstream conda packages
which check for the version of the library being built against.
For example: OpenGL functionality from the CentOS 7 packaged library is available, but
any newer functionality cannot be used.</li>
<li class="">We have no guarantees that the version provided by the user&#x27;s system is compatible.
We only have the <code>__glibc&gt;=2.17</code> constraint and we assume that CentOS 7&#x27;s
lower bound of GLIBC and its corresponding lower bound of the CDT are equivalent.</li>
<li class="">We have no guarantee that the library is provided by the user&#x27;s system at all.</li>
</ol>
<p><a id="when-should-cdts-be-used" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-should-cdts-be-used">When should CDTs be used?<a href="#when-should-cdts-be-used" class="hash-link" aria-label="Direct link to When should CDTs be used?" title="Direct link to When should CDTs be used?" translate="no">​</a></h4>
<ol>
<li class="">When there are system specific configurations are used by the library.
Some examples include:
<ol>
<li class="">linux-pam: This is a library that allows pluggable authentication modules and the
configuration files for these modules usually live in <code>/etc/pam.d</code>. The issue is that
the pluggable modules live in a distro specific location. For example:
<code>/usr/lib/x86_64-linux-gnu/security/</code>. The default modules are built into the
conda package in <code>$CONDA_PREFIX/lib/security</code>, but custom ones for
system-wide configuration are installed into <code>/usr/lib/x86_64-linux-gnu/security/</code>.
So, we would need to patch the module to look into both, but the directory
<code>/usr/lib/x86_64-linux-gnu/security/</code> is distro specific and will be hard to
detect.</li>
</ol>
</li>
<li class="">When a conda packaged library will not work properly.
For example: a new <code>glibc</code> package means we would have to edit the elf interpreter of
all the conda package binaries.</li>
</ol>
<p><a id="what-s-are-some-good-examples" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="whats-are-some-good-examples">What&#x27;s are some good examples?<a href="#whats-are-some-good-examples" class="hash-link" aria-label="Direct link to What&#x27;s are some good examples?" title="Direct link to What&#x27;s are some good examples?" translate="no">​</a></h4>
<ol>
<li class="">The OpenCL loader (<code>ocl-icd</code> together with <code>ocl-icd-system</code>) provides an OpenCL
loading library. The loader will look at OpenCL implementations given in
<code>$CONDA_PREFIX/etc/OpenCL/vendors</code>.
For example: Pocl is a conda packaged implementation that runs OpenCL on the CPU. Vendor
specific implementations like the NVIDIA OpenCL or ROCm OpenCL are not conda packaged, so we
have to rely on the system. By installing <code>ocl-icd-system</code> we enable the loader to look at
the configuration in <code>/etc/OpenCL/vendors</code>, which is the configuration directory for all linux
distributions. This gives us the best of both worlds. You don&#x27;t need a system level package to
run OpenCL because we have a conda packaged installation, but if there is a system wide
implementation that is accelerated by specific hardware, we can use those.</li>
</ol>
<p><a id="libgl" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="libgl">libGL<a href="#libgl" class="hash-link" aria-label="Direct link to libGL" title="Direct link to libGL" translate="no">​</a></h3>
<p>Note that packages dependent on OpenGL and/or libGL should no longer use CDTs. Instead, use the host dependency <code>libgl-devel</code> from the <a href="https://github.com/conda-forge/libglvnd-feedstock" target="_blank" rel="noopener noreferrer" class="">libglvnd-feedstock</a>.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> libgl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">devel  </span><span class="token comment" style="color:#999988;font-style:italic"># [linux]</span><br></span></code></pre></div></div>
<p>Other OpenGL API variants such as <code>libegl-devel</code>, <code>libgles-devel</code>, <code>libglx-devel</code>, and <code>libopengl-devel</code> are also available, and will automatically add non-development <code>run_exports</code> dependencies.</p>
<p><a id="linking-numpy" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="building-against-numpy" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="building-against-numpy">Building Against NumPy<a href="#building-against-numpy" class="hash-link" aria-label="Direct link to Building Against NumPy" title="Direct link to Building Against NumPy" translate="no">​</a></h3>
<p>Finding <code>numpy.get_include()</code> in <code>setup.py</code> or <code>cimport</code> statements in <code>.pyx</code> or <code>.pyd</code> files are a telltale sign that the package links against NumPy.</p>
<p>Adding <code>numpy</code> in the <code>host:</code> section is sufficient to have a compatible NumPy version at run time:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> numpy</span><br></span></code></pre></div></div>
<p>At the time of writing (June 2025), the above is equivalent to the following:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">recipe/conda_build_config.yaml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> numpy 2.*</span><br></span></code></pre></div></div>
<p>See the pinning repository for
<a href="https://github.com/conda-forge/conda-forge-pinning-feedstock/blob/main/recipe/conda_build_config.yaml" target="_blank" rel="noopener noreferrer" class="">what the pinning corresponds to</a> at any given time.</p>
<p>In either case, the actual runtime requirements are determined through numpy&#x27;s
run-export, which is:</p>
<ul>
<li class=""><code>&gt;=1.2x,&lt;2</code> if you&#x27;re building against numpy 1.2x</li>
<li class=""><code>&gt;=1.19,&lt;3</code> if you&#x27;re building against numpy 2.0</li>
<li class=""><code>&gt;=1.21,&lt;3</code> if you&#x27;re building against numpy 2.1 or 2.2</li>
<li class=""><code>&gt;=1.23,&lt;3</code> if you&#x27;re building against numpy 2.3</li>
</ul>
<p>If the package you are building has a higher minimum requirement for numpy, please add this under <code>run</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># leave this unpinned!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> numpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> numpy </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> the_lower_bound_your_package_needs </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><a id="jupyterlab-extension" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="jupyterlab-extensions" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="jupyterlab-extensions">JupyterLab Extensions<a href="#jupyterlab-extensions" class="hash-link" aria-label="Direct link to JupyterLab Extensions" title="Direct link to JupyterLab Extensions" translate="no">​</a></h3>
<p>A typical JupyterLab extension has both Python and JavaScript components.
These should be packaged together, to prevent node from being needing to
grab the JavaScript side of the package on the user&#x27;s machine. To package
an extension, the build should have the following <code>meta.yaml</code> snippet:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">noarch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> python_min </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nodejs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> python_min </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nodejs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> jupyterlab </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">=2</span><br></span></code></pre></div></div>
<p>Please use the following <code>build.sh</code> script in your recipe:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/usr/bin/env bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-ex</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$PYTHON</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-vv</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> pack </span><span class="token variable" style="color:#36acaa">${PKG_NAME}</span><span class="token plain">@</span><span class="token variable" style="color:#36acaa">${PKG_VERSION}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${PREFIX}</span><span class="token plain">/share/jupyter/lab/extensions/js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${PKG_NAME}</span><span class="token plain">-</span><span class="token variable" style="color:#36acaa">${PKG_VERSION}</span><span class="token plain">.tgz </span><span class="token variable" style="color:#36acaa">${PREFIX}</span><span class="token plain">/share/jupyter/lab/extensions/js</span><br></span></code></pre></div></div>
<p>Since this is a noarch recipe, the build script only needs to run on <code>linux-64</code>.
Also note that we do not need to run <code>jupyter labextension install</code> or
<code>jupyter lab build</code> as part of the package build or in any post-link scripts.
This is because JupyterLab will run the build step itself when it is next run.
The <code>${PREFIX}/share/jupyter/lab/extensions/js</code> directory which JupyterLab
knows to build from when performing this build step.</p>
<p><a id="message-passing-interface-mpi" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="message-passing-interface-mpi">Message passing interface (MPI)<a href="#message-passing-interface-mpi" class="hash-link" aria-label="Direct link to Message passing interface (MPI)" title="Direct link to Message passing interface (MPI)" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>This section originates from Min&#x27;s notes: <a href="https://hackmd.io/ry4uI0thTs2q_b4mAQd_qg" target="_blank" rel="noopener noreferrer" class="">https://hackmd.io/ry4uI0thTs2q_b4mAQd_qg</a></p></div></div>
<p><a id="mpi-variants-in-conda-forge" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="mpi-variants-in-conda-forge">MPI Variants in conda-forge<a href="#mpi-variants-in-conda-forge" class="hash-link" aria-label="Direct link to MPI Variants in conda-forge" title="Direct link to MPI Variants in conda-forge" translate="no">​</a></h4>
<p>How are MPI variants best handled in conda-forge?</p>
<p>There are a few broad cases:</p>
<ul>
<li class="">package requires a specific MPI provider (easy!)</li>
<li class="">the package works with any MPI provider (e.g. mpich, openmpi)</li>
<li class="">the package works with/without MPI</li>
</ul>
<p>Note that sometimes users want to use packages in conda-forge built against
our MPI libraries but linked to external MPI libraries at runtime. If you are interested
in this procedure, see <a class="" href="/docs/user/tipsandtricks/#using-external-message-passing-interface-mpi-libraries">Using External Message Passing Interface (MPI) Libraries</a>
for details.</p>
<p><a id="building-mpi-variants" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="building-mpi-variants">Building MPI variants<a href="#building-mpi-variants" class="hash-link" aria-label="Direct link to Building MPI variants" title="Direct link to Building MPI variants" translate="no">​</a></h4>
<p>In conda_build_config.yaml:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mpi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mpich</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> openmpi</span><br></span></code></pre></div></div>
<p>In meta.yaml:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>And rerender with:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda-smithy rerender </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> auto</span><br></span></code></pre></div></div>
<p>to produce the build matrices.</p>
<p><a id="including-a-no-mpi-build" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="including-a-no-mpi-build">Including a no-mpi build<a href="#including-a-no-mpi-build" class="hash-link" aria-label="Direct link to Including a no-mpi build" title="Direct link to Including a no-mpi build" translate="no">​</a></h4>
<p>Some packages (e.g. hdf5) may want a no-mpi build, in addition to the mpi builds.
To do this, add nompi to the mpi matrix:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">mpi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nompi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mpich</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> openmpi</span><br></span></code></pre></div></div>
<p>and apply the appropriate conditionals in your build:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [mpi != &#x27;nompi&#x27;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [mpi != &#x27;nompi&#x27;]</span><br></span></code></pre></div></div>
<p><a id="preferring-a-provider-usually-nompi" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="preferring-a-provider-usually-nompi">Preferring a provider (usually nompi)<a href="#preferring-a-provider-usually-nompi" class="hash-link" aria-label="Direct link to Preferring a provider (usually nompi)" title="Direct link to Preferring a provider (usually nompi)" translate="no">​</a></h4>
<p>Up to here, mpi providers have no explicit preference. When choosing an MPI provider, the mutual exclusivity of
the <code>mpi</code> metapackage allows picking between mpi providers by installing an mpi provider, e.g.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> mpich ptscotch</span><br></span></code></pre></div></div>
<p>or</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> openmpi ptscotch</span><br></span></code></pre></div></div>
<p>This doesn&#x27;t extend to <code>nompi</code>, because there is no <code>nompi</code> variant of the mpi metapackage. And there probably
shouldn&#x27;t be, because some packages built with mpi don&#x27;t preclude other packages in the env that <em>may</em> have an mpi variant
from using the no-mpi variant of the library (e.g. for a long time, fenics used mpi with no-mpi hdf5 since there was no
parallel hdf5 yet. This works fine, though some features may not be available).</p>
<p>Typically, if there is a preference it will be for the serial build, such that installers/requirers of the package
only get the mpi build if explicitly requested. We use a higher build number for the <code>nompi</code> variant in this case.</p>
<p>Here is an example build section:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% if mpi == &#x27;nompi&#x27; %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># prioritize nompi variant via build number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% set build = build + 100 %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% endif %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> build </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># add build string so packages can depend on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># mpi or nompi variants explicitly:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># `pkg * mpi_mpich_*` for mpich</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># `pkg * mpi_*` for any mpi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># `pkg * nompi_*` for no mpi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% if mpi </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &#x27;nompi&#x27; %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% set mpi_prefix = &quot;mpi_&quot; + mpi %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% else %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% set mpi_prefix = &quot;nompi&quot; %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% endif %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">string</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ mpi_prefix }}_h{{ PKG_HASH }}_{{ build }}&quot;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><code>{{ PKG_HASH }}</code> avoids build string collisions on <em>most</em> variants,
but not on packages that are excluded from the default build string,
e.g. Python itself. If the package is built for multiple Python versions, use:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">string</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ mpi_prefix }}_py{{ py }}h{{ PKG_HASH }}_{{ build }}&quot;</span><br></span></code></pre></div></div><p>as seen in <a href="https://github.com/conda-forge/h5py-feedstock/pull/49/commits/b08ee9307d16864e775f1a7f9dd10f25c83b5974" target="_blank" rel="noopener noreferrer" class="">mpi4py</a></p></div></div>
<p>This build section creates the following packages:</p>
<ul>
<li class=""><code>pkg-x.y.z-mpi_mpich_h12345_0</code></li>
<li class=""><code>pkg-x.y.z-mpi_openmpi_h23456_0</code></li>
<li class=""><code>pkg-x.y.z-nompi_h34567_100</code></li>
</ul>
<p>Which has the following consequences:</p>
<ul>
<li class="">The <code>nompi</code> variant is preferred, and will be installed by default unless an mpi variant is explicitly requested.</li>
<li class="">mpi variants can be explicitly requested with <code>pkg=*=mpi_{{ mpi }}_*</code></li>
<li class="">any mpi variant, ignoring provider, can be requested with <code>pkg=*=mpi_*</code></li>
<li class="">nompi variant can be explicitly requested with <code>pkg=*=nompi_*</code></li>
</ul>
<p>If building with this library creates a runtime dependency on the variant, the build string pinning can be added to <code>run_exports</code>.</p>
<p>For example, if building against the nompi variant will work with any installed version, but building with a
given mpi provider requires running with that mpi:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% if mpi </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &#x27;nompi&#x27; %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run_exports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> * </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi_prefix </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">_*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% endif %</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Remove the <code>if mpi...</code> condition if all variants should create a strict runtime dependency based on the variant
chosen at build time (i.e. if the nompi build cannot be run against the mpich build).</p>
<p><a id="complete-example" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-example">Complete example<a href="#complete-example" class="hash-link" aria-label="Direct link to Complete example" title="Direct link to Complete example" translate="no">​</a></h4>
<p>Combining all of the above, here is a complete recipe, with:</p>
<ul>
<li class="">nompi, mpich, openmpi variants</li>
<li class="">run-exports to apply mpi choice made at build time to runtime where nompi builds can be run with mpi, but not vice versa.</li>
<li class="">nompi variant is preferred by default</li>
<li class="">only build nompi on Windows</li>
</ul>
<p>This matches what is done in <a href="https://github.com/conda-forge/hdf5-feedstock/pull/90" target="_blank" rel="noopener noreferrer" class="">hdf5</a>.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># conda_build_config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mpi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nompi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mpich  </span><span class="token comment" style="color:#999988;font-style:italic"># [not win]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> openmpi  </span><span class="token comment" style="color:#999988;font-style:italic"># [not win]</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># meta.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% set name = &#x27;pkg&#x27; %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% set build = 0 %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ensure mpi is defined (needed for conda-smithy recipe-lint)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% set mpi = mpi or &#x27;nompi&#x27; %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% if mpi == &#x27;nompi&#x27; %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># prioritize nompi variant via build number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% set build = build + 100 %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% endif %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> build </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># add build string so packages can depend on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># mpi or nompi variants explicitly:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># `pkg * mpi_mpich_*` for mpich</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># `pkg * mpi_*` for any mpi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># `pkg * nompi_*` for no mpi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% if mpi </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &#x27;nompi&#x27; %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% set mpi_prefix = &quot;mpi_&quot; + mpi %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% else %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% set mpi_prefix = &quot;nompi&quot; %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% endif %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">string</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ mpi_prefix }}_h{{ PKG_HASH }}_{{ build }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% if mpi </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &#x27;nompi&#x27; %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run_exports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> * </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi_prefix </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">_*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% endif %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [mpi != &#x27;nompi&#x27;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [mpi != &#x27;nompi&#x27;]</span><br></span></code></pre></div></div>
<p>And then a package that depends on this one can explicitly pick the appropriate mpi builds:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># meta.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [mpi != &#x27;nompi&#x27;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pkg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pkg * mpi_</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">_*  </span><span class="token comment" style="color:#999988;font-style:italic"># [mpi != &#x27;nompi&#x27;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [mpi != &#x27;nompi&#x27;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pkg * mpi_</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">_*  </span><span class="token comment" style="color:#999988;font-style:italic"># [mpi != &#x27;nompi&#x27;]</span><br></span></code></pre></div></div>
<p>mpi-metapackage exclusivity allows <code>mpi_*</code> to resolve the same as <code>mpi_{{ mpi }}_*</code>
if <code>{{ mpi }}</code> is also a direct dependency, though it&#x27;s probably nicer to be explicit.</p>
<p><a id="just-mpi-example" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="just-mpi-example">Just mpi example<a href="#just-mpi-example" class="hash-link" aria-label="Direct link to Just mpi example" title="Direct link to Just mpi example" translate="no">​</a></h4>
<p>Without a preferred <code>nompi</code> variant, recipes that require mpi are much simpler. This is all that is needed:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># conda_build_config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mpi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mpich</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> openmpi</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># meta.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mpi </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><a id="mpi-compiler-packages" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="mpi-compiler-packages">MPI Compiler Packages<a href="#mpi-compiler-packages" class="hash-link" aria-label="Direct link to MPI Compiler Packages" title="Direct link to MPI Compiler Packages" translate="no">​</a></h4>
<p>Do not use the <code>[openmpi,mpich]-[mpicc,mpicxx,mpifort]</code> metapackages in the <code>requirements/build</code> section
of a recipe; the MPI compiler wrappers are included in the main <code>openmpi</code>/<code>mpich</code> packages.
As shown above, just add <code>openmpi</code>/<code>mpich</code> to the <code>requirements/host</code> section and use compiler directives for the
corresponding compilers in <code>requirements/build</code> as normal.</p>
<p><a id="openmp" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="openmp">OpenMP<a href="#openmp" class="hash-link" aria-label="Direct link to OpenMP" title="Direct link to OpenMP" translate="no">​</a></h3>
<p>The default OpenMP runtime used depends on the compiler and platform used. GCC (on Linux and the Windows MinGW
toolchain) uses the <code>libgomp</code> runtime. Clang (on all platforms) and GNU Fortran on macOS default to the <code>llvm-openmp</code>
runtime. MSVC may use its own runtime or <code>llvm-openmp</code>. However, individual projects may force building against
a different runtime through their build system configuration.</p>
<p>On Linux, building against <code>libgomp</code> is recommended as the other OpenMP providers are backwards compatible with it.
When packages are built against <code>libgomp</code>, it is possible to use both <code>libgomp</code> and <code>llvm-openmp</code> provider at runtime.</p>
<p>Dependencies on OpenMP providers belong in the <code>host</code> section of recipe dependencies. The following snippet corresponds
to the defaults, though individual packages may require a different set:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># meta.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> llvm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">openmp  </span><span class="token comment" style="color:#999988;font-style:italic"># [osx]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> libgomp      </span><span class="token comment" style="color:#999988;font-style:italic"># [linux]</span><br></span></code></pre></div></div>
<p><a id="switching-openmp-implementation" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="switching-openmp-implementation">Switching OpenMP implementation<a href="#switching-openmp-implementation" class="hash-link" aria-label="Direct link to Switching OpenMP implementation" title="Direct link to Switching OpenMP implementation" translate="no">​</a></h4>
<p>On macOS, only LLVM&#x27;s OpenMP implementation <code>llvm-openmp</code> is supported. This implementation is used even in Fortran code compiled
using GNU&#x27;s gfortran.</p>
<p>On Windows, switching between different OpenMP implemnentations is not supported. Every package uses the implementation
it was built against.</p>
<p>On Linux, when packages are linked against GNU&#x27;s <code>libgomp.so.1</code>, the OpenMP library at install time can be
switched from GNU to LLVM by doing the following.</p>
<div class="language-shell-session codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell-session codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token output">conda install _openmp_mutex=*=*_llvm</span><br></span></code></pre></div></div>
<p>OpenMP library can be switched back to GNU&#x27;s libgomp by doing the following.</p>
<div class="language-shell-session codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell-session codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token output">conda install _openmp_mutex=*=*_gnu</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>OpenMP library switching is possible because LLVM&#x27;s implementation has the symbol&#x27;s from GNU in addition to the LLVM
ones (originally from Intel). An object file generated by <code>gcc</code>, <code>g++</code> or <code>gfortran</code> will have GNU&#x27;s symbols and
therefore the underlying library can be switched.
However, an object file generated by <code>clang</code> or <code>clang++</code> will have LLVM&#x27;s symbols and therefore the underlying
OpenMP library cannot be switched to GNU&#x27;s library.</p><p>One reason you may wish to switch to LLVM is because the implementation is fork safe. One reason to keep using the
GNU implementation is that the OpenMP target offloading symbols in <code>libgomp</code> like <code>GOMP_target</code> are empty stubs
in LLVM and therefore does not work.</p></div></div>
<p><a id="yum-deps" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="yum-requirements-txt" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="yum_requirementstxt">yum_requirements.txt<a href="#yum_requirementstxt" class="hash-link" aria-label="Direct link to yum_requirements.txt" title="Direct link to yum_requirements.txt" translate="no">​</a></h3>
<p>Dependencies can be installed into the build container with <code>yum</code>, by listing package names line by line in a file
named <code>yum_requirements.txt</code> in the <code>recipe</code> directory of a feedstock.</p>
<p>There are only very few situations where dependencies installed by yum are acceptable. These cases include</p>
<ul>
<li class="">satisfying the requirements of <a class="" href="/docs/glossary/#cdt">CDT</a> packages during test phase</li>
<li class="">installing packages that are only required for testing</li>
</ul>
<p>After changing <code>yum_requirements.txt</code>, <a class="" href="/docs/maintainer/updating_pkgs/#dev-update-rerender">rerender</a> to update the configuration.</p>
<p><a id="knowledge-blas" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="blas" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="blas">BLAS<a href="#blas" class="hash-link" aria-label="Direct link to BLAS" title="Direct link to BLAS" translate="no">​</a></h3>
<p>If a package needs one of BLAS, CBLAS, LAPACK, LAPACKE, use the following in the
host of the recipe,</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> libblas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> libcblas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> liblapack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> liblapacke</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>You should specify only the libraries that the package needs. (i.e. if the package
doesn&#x27;t need LAPACK, remove liblapack and liblapacke)</p><p>At recipe build time, above requirements would download the NETLIB&#x27;s reference
implementations and build your recipe against those.
At runtime, by default the following packages will be used.</p></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> openblas   </span><span class="token comment" style="color:#999988;font-style:italic"># [not win]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mkl        </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><br></span></code></pre></div></div>
<p>If a package needs a specific implementation&#x27;s internal API for more control you can have,</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Keep mkl-devel here for pinning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mkl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">devel         </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> blas_impl == &quot;mkl&quot; </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> blas_impl </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> blas_impl </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &quot;mkl&quot; </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> libblas * *</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> blas_impl </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> blas_impl </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>This would give you a matrix builds for different blas implementations. If you only want to support
a specific blas implementation,</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> openblas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> libblas * </span><span class="token important">*openblas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> openblas</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><code>blas_*</code> features should not be used anymore.</p></div></div>
<p><a id="switching-blas-implementation" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="switching-blas-implementation">Switching BLAS implementation<a href="#switching-blas-implementation" class="hash-link" aria-label="Direct link to Switching BLAS implementation" title="Direct link to Switching BLAS implementation" translate="no">​</a></h4>
<p>You can switch your BLAS implementation by doing,</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;libblas=*=*_mkl&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;libblas=*=*_openblas&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;libblas=*=*_blis&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;libblas=*=*_accelerate&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;libblas=*=*_newaccelerate&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;libblas=*=*_netlib&quot;</span><br></span></code></pre></div></div>
<p>This would change the BLAS implementation without changing the conda packages depending
on BLAS.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>For macOS 13.3+, you can use <code>newaccelerate</code> to use the new BLAS/LAPACK
support in Accelerate.</p><p>The following legacy commands are also supported as well.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blas=*=mkl&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blas=*=openblas&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blas=*=blis&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blas=*=accelerate&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blas=*=newaccelerate&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blas=*=netlib&quot;</span><br></span></code></pre></div></div><div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If you want to commit to a specific blas implementation, you can prevent conda from switching back by pinning
the blas implementation in your environment. To commit to mkl, add <code>blas=*=mkl</code> to
<code>&lt;conda-root&gt;/envs/&lt;env-name&gt;/conda-meta/pinned</code>, as described in the
<a href="https://docs.conda.io/projects/conda/en/stable/user-guide/tasks/manage-pkgs.html#preventing-packages-from-updating-pinning" target="_blank" rel="noopener noreferrer" class="">conda-docs</a>.</p></div></div></div></div>
<p><a id="how-it-works" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-it-works">How it works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How it works" title="Direct link to How it works" translate="no">​</a></h4>
<p>At recipe build time, the netlib packages are used. This means that the downstream package will
link to <code>libblas.so.3</code> in the <code>libblas=*=*netlib</code> and will use only the reference
implementation&#x27;s symbols.</p>
<p><code>libblas</code> and <code>libcblas</code> versioning is based on the Reference LAPACK versioning which at the
time of writing is <code>3.8.0</code>. Since the BLAS API is stable, a downstream package will only pin to
<code>3.*</code> of <code>libblas</code> and <code>libcblas</code>. On the other hand, <code>liblapack</code> and <code>liblapacke</code> pins to
<code>3.8.*</code>.</p>
<p>In addition to the above netlib package, there are other variants like <code>libblas=*=*openblas</code>,
which has <code>openblas</code> as a dependency and has a symlink from <code>libblas.so.3</code> to <code>libopenblas.so</code>.
<code>libblas=3.8.0=*openblas</code> pins the <code>openblas</code> dependency to a version that is known to support the
BLAS <code>3.8.0</code> API. This means that, at install time, the user can select what BLAS implementation
they like without any knowledge of the version of the BLAS implementation needed.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="microarch">Microarchitecture-optimized builds<a href="#microarch" class="hash-link" aria-label="Direct link to Microarchitecture-optimized builds" title="Direct link to Microarchitecture-optimized builds" translate="no">​</a></h3>
<p>conda <a class="" href="/docs/glossary/#virtual-package">virtual packages</a> include <code>__archspec</code>, which expose the processor architecture to the solver. However, <code>__archspec</code> should not be used directly in recipes; instead, users should rely on the <a href="https://github.com/conda-forge/microarch-level-feedstock" target="_blank" rel="noopener noreferrer" class=""><code>microarch-level</code></a> helper packages (contributed in <a href="https://github.com/conda-forge/staged-recipes/pull/24306" target="_blank" rel="noopener noreferrer" class="">staged-recipes#24306</a>).</p>
<p>Before learning how to use it, please read these considerations:</p>
<ul>
<li class="">Adding microarchitecture variants can result in too many entries in the build matrix. Do not overuse it.</li>
<li class="">These optimized builds should only be used when the performance improvements are significant.</li>
<li class="">Preferably, the project should rely on runtime dispatch for arch-specific optimizations.</li>
<li class="">If the package is already too large, consider using smaller outputs for the arch-optimized variants.</li>
</ul>
<p>To implement microarchitecture-optimized builds in your feedstock, you&#x27;ll end up with something like:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">recipe/conda_build_config.yaml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">microarch_level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [unix and x86_64]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [unix and x86_64]</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">recipe/meta.yaml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% set build = 0 %</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> build </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># [not (unix and x86_64)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> build + 100 </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># [unix and x86_64 and microarch_level == 1]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> build + 300 </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># [unix and x86_64 and microarch_level == 3]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> build + 400 </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># [unix and x86_64 and microarch_level == 4]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> x86_64</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microarch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">level </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> microarch_level </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [unix and x86_64]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> compiler(&#x27;c&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Prioritize your preferred microarchitecture</div><div class="admonitionContent_BuS1"><p>The <code>run_exports</code> metadata is only set up with lower bounds to allow in-CI testing.
This means that <code>level=2</code> package can be installed in a <code>level=3</code> machine. Make sure
to assign a higher build number to the preferred microarchitecture (usually the highest level).</p></div></div>
<p>That&#x27;s it! The activation scripts behind the <code>microarch-level</code> packages are already injecting the necessary compiler flags for you. Since they also have <code>run_exports</code> entries, your
package will have the necessary runtime requirements to ensure the most adequate variant gets installed. Refer to <a href="https://github.com/conda-forge/staged-recipes/pull/24306#issuecomment-1800095471" target="_blank" rel="noopener noreferrer" class="">this comment</a> and the <a href="https://github.com/conda-forge/microarch-level-feedstock" target="_blank" rel="noopener noreferrer" class=""><code>microarch-level-feedstock</code> README</a> for more information.</p>
<p><a id="knowledge-mpl" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="matplotlib" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="matplotlib">Matplotlib<a href="#matplotlib" class="hash-link" aria-label="Direct link to Matplotlib" title="Direct link to Matplotlib" translate="no">​</a></h3>
<p><code>matplotlib</code> on conda-forge comes in two parts. The core library is in <code>matplotlib-base</code>. The
actual <code>matplotlib</code> package is this core library plus <code>pyside6</code>. Most, if not all, packages that have
dependence at runtime on <code>matplotlib</code> should list this dependence as <code>matplotlib-base</code> unless they
explicitly need <code>pyside6</code>. The idea is that a user installing <code>matplotlib</code> explicitly would get a full
featured installation with <code>pyside6</code>. However, <code>pyside6</code> is a rather large package, so not requiring it
indirectly is better for performance. Note that you may need to include a <code>yum_requirements.txt</code> file
in your recipe with</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">xorg-x11-server-Xorg</span><br></span></code></pre></div></div>
<p>if you import parts of <code>matplotlib</code> that link to <code>libX11</code>.</p>
<p><a id="pybind11-abi-constraints" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="pybind11-swig-abi-constraints" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pybind11-and-swig-abi-constraints"><code>pybind11</code> and <code>swig</code> ABI Constraints<a href="#pybind11-and-swig-abi-constraints" class="hash-link" aria-label="Direct link to pybind11-and-swig-abi-constraints" title="Direct link to pybind11-and-swig-abi-constraints" translate="no">​</a></h3>
<p>Sometimes when different python libraries using <code>pybind11</code>/<code>swig</code> interact via lower-level interfaces,
the underlying ABI between the two libraries has to match. To ease this use case, we have a <code>pybind11-abi</code>/<code>swig-abi</code>
metapackage that can be used in the <code>host</code> section of a build. Its version is pinned globally, and it has a
run export on itself, meaning that builds with this package in <code>host</code> will have a runtime constraint on it.
Further, the <code>pybind11</code>/<code>swig</code> has a run constraint on the respective ABI metapackage to help ensure
consistent usage.</p>
<p>To use this package in a build, put it in the host environment like so</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pybind11</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">abi</span><br></span></code></pre></div></div>
<p>or</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> swig</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">abi</span><br></span></code></pre></div></div>
<p><a id="knowledge-empty" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="empty-python-packages" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="empty-python-packages">Empty Python packages<a href="#empty-python-packages" class="hash-link" aria-label="Direct link to Empty Python packages" title="Direct link to Empty Python packages" translate="no">​</a></h3>
<p>For some features introduced in later Python versions, the Python community creates backports, which makes these
features available for earlier versions of Python as well.
One example here is <a href="https://www.python.org/dev/peps/pep-0557/" target="_blank" rel="noopener noreferrer" class="">dataclasses</a> which was introduced with
Python3.7 but is available as a <a href="https://github.com/ericvsmith/dataclasses" target="_blank" rel="noopener noreferrer" class="">backport</a> for Python3.6 too.
Therefore, most upstream packages make those backports only mandatory for specific versions of Python and exclude them otherwise.</p>
<p>Implementing this restriction in conda-forge is currently only possible through the use of <code>skips</code>
which restricts the corresponding conda-forge recipes from becoming <code>noarch</code>.</p>
<p>Therefore, some conda-forge recipes only create an actual package on specific Python versions and are otherwise an
empty placeholder. This allows them to be safely installed under all Python versions and makes using <code>skips</code> unnecessary.</p>
<p>Similarly, some packages are only platform-specific dependency of a package, such as <code>pywin32</code>, and have
helper metapackages which can help recipes stay <code>noarch</code>. The version of the actual package required
can be controlled with <code>run_constrained</code>, even for packages not available on all platforms.</p>
<p>Currently available packages:</p>



































<table><thead><tr><th>Name</th><th>Available on:</th><th>Empty on:</th></tr></thead><tbody><tr><td>backports.strenum</td><td>python &gt;=3.8,&lt;3.11</td><td>python &gt;=3.12</td></tr><tr><td>dataclasses</td><td>python &gt;=3.6,&lt;3.7</td><td>python &gt;=3.7</td></tr><tr><td>enum34</td><td>python =2.7</td><td>python &gt;=3.4</td></tr><tr><td>pywin32-on-windows</td><td>windows</td><td>unix</td></tr><tr><td>typing</td><td></td><td>python &gt;=3</td></tr></tbody></table>
<p><a id="knowledge-all-installs" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="non-version-specific-python-packages" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="non-version-specific-python-packages">Non-version-specific Python packages<a href="#non-version-specific-python-packages" class="hash-link" aria-label="Direct link to Non-version-specific Python packages" title="Direct link to Non-version-specific Python packages" translate="no">​</a></h3>
<p>For some dependencies, upstream maintainers list Python versions where those packages are needed,
even if the packages can actually be installed under all Python versions.</p>
<p>Implementing this restriction in conda-forge is currently only possible through the use of <code>skips</code>
which restricts the corresponding conda-forge recipes from becoming <code>noarch</code>.</p>
<p>Therefore, the conda-forge community maintains a list of packages that are safe to be installed under all Python versions,
even if the original package only requires it for some versions.</p>
<p>For example, the package <a href="https://github.com/rigetti/pyquil" target="_blank" rel="noopener noreferrer" class="">pyquil</a> only
<a href="https://github.com/rigetti/pyquil/blob/497791e8108d8780109d75410be786c5f6e590ea/pyproject.toml#L30" target="_blank" rel="noopener noreferrer" class="">requires</a> <code>importlib-metadata</code> for <code>python &lt;3.8</code> but it is actually safe to be installed under <code>python &gt;=3.8</code> as well.</p>
<p>Currently available packages:</p>
<ul>
<li class="">exceptiongroup</li>
<li class="">importlib-metadata</li>
</ul>
<p><a id="abi3" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="packages-with-abi3-extensions">Packages with abi3 extensions<a href="#packages-with-abi3-extensions" class="hash-link" aria-label="Direct link to Packages with abi3 extensions" title="Direct link to Packages with abi3 extensions" translate="no">​</a></h3>
<p>Packages can be built using CPython&#x27;s stable <a href="https://docs.python.org/3/c-api/stable.html" target="_blank" rel="noopener noreferrer" class=""><code>abi3</code> mode</a> by adding a few conditionals to the <code>build</code>, <code>requirements</code>, and (optionally) <code>test</code> sections. See <a href="https://github.com/conda-forge/python-abi3-feedstock/blob/main/recipe/example-meta.yaml" target="_blank" rel="noopener noreferrer" class="">this <code>meta.yaml</code> example</a> from the <code>python-abi3-feedstock</code>, in particular the parts that depend on the <code>is_abi3</code>, as well as the relevant <a href="https://docs.conda.io/projects/conda-build/en/stable/resources/define-metadata.html#python-version-independent-packages" target="_blank" rel="noopener noreferrer" class="">conda-build documentation</a>.</p>
<p>Note that the python extension that is being packaged needs to support building the extension as an ABI3 package. For setuptools
based projects, the keyword argument <code>py_limited_api=True</code> needs to be passed to the <code>setup</code> function.</p>
<p><a id="noarch-builds" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="noarch-builds">Noarch builds<a href="#noarch-builds" class="hash-link" aria-label="Direct link to Noarch builds" title="Direct link to Noarch builds" translate="no">​</a></h2>
<p>Noarch packages are packages that are not architecture specific and therefore only have to be built once.</p>
<p>Declaring these packages as <code>noarch</code> in the <code>build</code> section of the meta.yaml, reduces shared CI resources.
Therefore all packages that qualify to be noarch packages should be declared as such.</p>
<p><a id="noarch" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="noarch-python" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="noarch-python">Noarch python<a href="#noarch-python" class="hash-link" aria-label="Direct link to Noarch python" title="Direct link to Noarch python" translate="no">​</a></h3>
<p>The <code>noarch: python</code> directive, in the <code>build</code> section, makes pure-Python
packages that only need to be built once.</p>
<p>In order to qualify as a noarch python package, all of the following criteria must be fulfilled:</p>
<ul>
<li class="">No compiled extensions</li>
<li class="">No post-link or pre-link or pre-unlink scripts</li>
<li class="">No OS-specific build scripts</li>
<li class="">No python version specific requirements</li>
<li class="">No skips except for python version. If the recipe is py3 only, remove skip
statement and add version constraint on python in <code>host</code> and <code>run</code>
section.</li>
<li class=""><code>2to3</code> is not used</li>
<li class=""><code>scripts</code> argument in <code>setup.py</code> is not used</li>
<li class="">If <code>console_scripts</code> <code>entry_points</code> are defined in <code>setup.py</code> or <code>setup.cfg</code>, they are also
<a href="https://conda.io/projects/conda-build/en/stable/resources/define-metadata.html#python-entry-points" target="_blank" rel="noopener noreferrer" class="">listed</a>
in the <code>build</code> section of <code>meta.yaml</code></li>
<li class="">No activate scripts</li>
</ul>
<p>All recipes employing <code>noarch: python</code> should usually use the <code>python_min</code> variable per the following example:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">recipe/meta.yaml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">noarch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> python_min </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> python_min </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> python_min </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre></div></div>
<p>See <a href="https://github.com/conda-forge/cfep/blob/main/cfep-25.md" target="_blank" rel="noopener noreferrer" class="">CFEP-25</a> for more details on this syntax. If you
need to override this syntax, you can add a Jinja2 <code>set</code> statement (or equivalent <code>context</code> variable for v1 recipes)
at the top of your recipe like this</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">recipe/meta.yaml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">% set python_min = &quot;3.10&quot; %</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>It also possible to achieve the same effect by adding a <code>conda_build_config.yaml</code> file to your recipe that
contains a map like</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">recipe/conda_build_config.yaml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">python_min</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3.10&quot;</span><br></span></code></pre></div></div>
<p>If you go that route, you will need to <a class="" href="/docs/maintainer/infrastructure/#conda-forge-admin-please-rerender">rerender the feedstock</a>
after adding the <code>conda_build_config.yaml</code> file.</p>
<p>Using <code>noarch: python</code> packages, with <code>python {{ python_min }}</code> pins in their <code>test.requires</code> section, as
<code>downstream</code> tests can cause failures for the <code>upstream</code> package if the Python version required for the test
conflicts with <code>upstream</code> package&#x27;s Python version. There are two fixes, depending on what is more important.</p>
<ol>
<li class="">Constrain the <code>downstream</code> tests in the <code>upstream</code> package to only run on <code>python_min</code>.</li>
<li class="">Remove the <code>python_min</code> requirement from the <code>downstream</code> package&#x27;s test requirements.</li>
</ol>
<p>More or less, you prefer the first solution when testing the <code>downstream</code> package on <code>python_min</code> is the most important thing. You prefer the second solution when testing all Python versions of the <code>upstream</code> package with the <code>downstream</code> package is the most important thing.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Hint</div><div class="admonitionContent_BuS1"><p>Adding an explicit <code>python_min</code> to your <code>noarch: python</code> recipe can be an effective way to ensure the required
Python in your package&#x27;s metadata is enforced at <code>conda-build</code> time, as the build will fail if the package&#x27;s
required Python version is newer than <code>python_min</code>.</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>While <code>noarch: python</code> does not work with selectors, it does work with version constraints.
<code>skip: True  # [py2k]</code> can be replaced with a constrained python version in the host and run subsections:
say <code>python &gt;=3</code> instead of just <code>python</code>.</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Only <code>console_scripts</code> entry points have to be listed in <code>meta.yaml</code>. Other entry points do not conflict
with <code>noarch</code> and therefore do not require extra treatment.</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><code>noarch</code> is a statement about the package&#x27;s source code and not its install environment. A package is still considered
<code>noarch</code> even if one of its dependencies is not available on a given platform. If this is the case, conda will
display a helpful error message describing which dependency couldn&#x27;t be found when it tries to install the package.
If the dependency is later made available, your package will be installable on that platform without having to make
any changes to the feedstock.</p><p>By default, <code>noarch</code> packages are built on Linux, and all dependencies must be available on Linux.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Hint</div><div class="admonitionContent_BuS1"><p>If a <code>noarch</code> package cannot be built on Linux, one or more <code>noarch_platforms</code> can be provided in
<code>conda-forge.yml</code>. One example is <a href="https://github.com/conda-forge/pywin32-on-windows-feedstock" target="_blank" rel="noopener noreferrer" class="">pywin32-on-windows</a>,
which builds on Linux and Windows, with <code>build_number</code> offsets to create a pair packages, like
<code>dataclasses</code>.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Hint</div><div class="admonitionContent_BuS1"><p>You can build platform-specific <code>noarch</code> packages to include runtime requirements depending on the target OS.
See mini-tutorial below.</p></div></div>
<p>If an existing python package qualifies to be converted to a noarch package, you can request the required changes
by opening a new issue and including <code>@conda-forge-admin, please add noarch: python</code>.</p>
<p><a id="os-specific-noarch" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="noarch-packages-with-os-specific-dependencies" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="noarch-packages-with-os-specific-dependencies">Noarch packages with OS-specific dependencies<a href="#noarch-packages-with-os-specific-dependencies" class="hash-link" aria-label="Direct link to Noarch packages with OS-specific dependencies" title="Direct link to Noarch packages with OS-specific dependencies" translate="no">​</a></h4>
<p>It is possible to build <code>noarch</code> packages with runtime requirements that depend on the target OS
(Linux, Windows, MacOS), regardless the architecture (amd64, ARM, PowerPC, etc). This approach
relies on three concepts:</p>
<ol>
<li class=""><a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-virtual.html" target="_blank" rel="noopener noreferrer" class="">Virtual packages</a>.
Prefixed with a double underscore, they are used by conda to represent system properties as
constraints for the solver at install-time. We will use <code>__linux</code>, <code>__win</code> or <code>__osx</code>,
which are only present when the running platform is Linux, Windows, or MacOS, respectively.
<code>__unix</code> is present in both Linux and MacOS. Note that this feature is <strong>only fully available
on conda 4.10 or above</strong>.</li>
<li class=""><code>conda-forge.yml</code>&#x27;s <a class="" href="/docs/maintainer/conda_forge_yml/#noarch-platforms">noarch_platforms</a> option.</li>
<li class=""><strong>conda-build 3.25.0 or above</strong> changing the build hash depending on virtual packages used.</li>
</ol>
<p>The idea is to generate different noarch packages for each OS needing different dependencies.
Let&#x27;s say you have a pure Python package, perfectly eligible for <code>noarch: python</code>, but on Windows
it requires <code>windows-only-dependency</code>. You might have something like:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">recipe/meta.yaml (original)</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> numpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> windows</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">only</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dependency  </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><br></span></code></pre></div></div>
<p>Being non-noarch, this means that the build matrix will include at least 12 outputs: three platforms,
times four Python versions. This gets worse with <code>arm64</code>, <code>aarch64</code> and <code>ppc64le</code> in the mix.
We can get it down to two outputs if replace it with this other approach!</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">recipe/meta.yaml (modified)</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">noarch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> python_min </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> python_min </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> numpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __unix  </span><span class="token comment" style="color:#999988;font-style:italic"># [unix]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __win   </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> windows</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">only</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dependency  </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><br></span></code></pre></div></div>
<p>Do not forget to specify the platform virtual packages with their selectors!
Otherwise, the solver will not be able to choose the variants correctly.</p>
<p>By default, conda-forge will only build <code>noarch</code> packages on a <code>linux_64</code> CI runner, so
only the <code># [unix]</code> selectors would be true. However, we can change this behaviour using
the <code>noarch_platforms</code> option in <code>conda-forge.yml</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">conda-forge.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">noarch_platforms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> linux_64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> win_64</span><br></span></code></pre></div></div>
<p>This will provide two runners per package! Perfect! All these changes require a
feedstock rerender to be applied. See <a class="" href="/docs/maintainer/updating_pkgs/#dev-update-rerender">Rerendering feedstocks</a>.</p>
<p>If you need conditional dependencies on all three operating systems, this is how you do it:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">recipe/meta.yaml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">noarch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> python_min </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> numpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __linux  </span><span class="token comment" style="color:#999988;font-style:italic"># [linux]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __osx    </span><span class="token comment" style="color:#999988;font-style:italic"># [osx]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> __win    </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> linux</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">only</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dependency    </span><span class="token comment" style="color:#999988;font-style:italic"># [linux]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> osx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">only</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dependency      </span><span class="token comment" style="color:#999988;font-style:italic"># [osx]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> windows</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">only</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dependency  </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">conda-forge.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">noarch_platforms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> linux_64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> osx_64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> win_64</span><br></span></code></pre></div></div>
<p>Again, remember to rerender after adding / modifying these files so the changes are applied.</p>
<p><a id="noarch-generic" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="noarch-generic">Noarch generic<a href="#noarch-generic" class="hash-link" aria-label="Direct link to Noarch generic" title="Direct link to Noarch generic" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Todo</div><div class="admonitionContent_BuS1"><p>add some information on r packages which make heavy use of <code>noarch: generic</code></p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="multi-output-recipes">Multi-output recipes<a href="#multi-output-recipes" class="hash-link" aria-label="Direct link to Multi-output recipes" title="Direct link to Multi-output recipes" translate="no">​</a></h2>
<p><code>conda-build</code> has the ability to create multiple package artifacts from a single recipe via the <code>outputs</code> section in <code>meta.yaml</code>. This is useful in several scenarios, including:</p>
<ul>
<li class="">Distributing a project (which share the same source code) in separate artifacts. For example:
<ul>
<li class="">A compiled C++ library and its Python bindings:
<ul>
<li class=""><a href="https://github.com/conda-forge/mamba-feedstock/blob/e13e667edd0e9efb5091444c11307ddb2bd8fa5e/recipe/meta.yaml" target="_blank" rel="noopener noreferrer" class="">mamba-feedstock</a></li>
</ul>
</li>
<li class="">A runtime library and its headers:
<ul>
<li class=""><a href="https://github.com/conda-forge/cpp-opentelemetry-sdk-feedstock/blob/6c9f81074f0343f2fb41a4491e91b7b84e962cc1/recipe/meta.yaml" target="_blank" rel="noopener noreferrer" class="">cpp-opentelemetry-sdk</a></li>
</ul>
</li>
<li class="">A dynamic library and a static version:
<ul>
<li class=""><a href="https://github.com/conda-forge/libarchive-feedstock/blob/642a473daf5cfc84598ed7fde1016c243e359e3b/recipe/meta.yaml" target="_blank" rel="noopener noreferrer" class="">libarchive</a></li>
</ul>
</li>
</ul>
</li>
<li class="">Distributing the same project with different sets of dependencies. For example:
<ul>
<li class="">The project with the minimal dependencies to run, and a separate output that extends that list:
<ul>
<li class=""><a href="https://github.com/conda-forge/geopandas-feedstock/blob/d6a3efdf12408f1875f1aa0b7cc2393f877a73e8/recipe/meta.yaml" target="_blank" rel="noopener noreferrer" class="">geopandas-base and geopandas</a></li>
<li class=""><a href="https://github.com/conda-forge/matplotlib-feedstock/blob/dc89bb11d502475b7bb71d8600b2eeaff4c185bd/recipe/meta.yaml" target="_blank" rel="noopener noreferrer" class="">matplotlib-base and matplotlib</a></li>
</ul>
</li>
<li class="">CPU vs GPU versions of a package (this can also be done with package variants):
<ul>
<li class=""><a href="https://github.com/conda-forge/pytorch-cpu-feedstock/blob/b629af608e13eb180dab698b1e44ac0991ab1135/recipe/meta.yaml" target="_blank" rel="noopener noreferrer" class="">pytorch-cpu, pytorch-gpu and pytorch</a></li>
</ul>
</li>
<li class="">A package with different strictness levels for its dependencies:
<ul>
<li class=""><a href="https://github.com/conda-forge/opencv-feedstock/blob/850a09ec4e4e1a34e2619c5b937bfdc8ffe8bbbd/recipe/meta.yaml" target="_blank" rel="noopener noreferrer" class="">opencv</a></li>
</ul>
</li>
</ul>
</li>
<li class="">Distributing the same project under two different names (alias packags). For example:
<ul>
<li class="">A package that changed names but wants to keep existing users up-to-date:</li>
<li class="">A package that uses dashes and underscores and expects users to use either:
<ul>
<li class=""><a href="https://github.com/conda-forge/importlib_metadata-feedstock/blob/e4595fd73bba559d248f97896aff89a762073f2a/recipe/meta.yaml" target="_blank" rel="noopener noreferrer" class="">importlib_metadata and importlib-metadata</a></li>
<li class=""><a href="https://github.com/conda-forge/typing_extensions-feedstock/blob/d9d0d1161d5ded886a272c0e4907f62d9272c7a8/recipe/meta.yaml" target="_blank" rel="noopener noreferrer" class="">typing_extensions and typing-extensions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-pitfalls-with-outputs">Common pitfalls with <code>outputs</code><a href="#common-pitfalls-with-outputs" class="hash-link" aria-label="Direct link to common-pitfalls-with-outputs" title="Direct link to common-pitfalls-with-outputs" translate="no">​</a></h3>
<p>This is a non-exhaustive list of common pitfalls when using <code>outputs</code>.</p>
<ul>
<li class="">It&#x27;s usually simpler to use a top-level name that does not match any output names. If the top-level name is different than the feedstock name, make sure to set the <code>extra.feedstock-name</code> in <code>meta.yaml</code>. See <a href="https://github.com/conda-forge/rich-feedstock/blob/0d745692c1bcf/recipe/meta.yaml#L110-L111" target="_blank" rel="noopener noreferrer" class="">rich-feedstock</a>. Note how the top-level name is <code>rich-split</code>, the feedstock name is <code>rich</code> and the main output is <code>rich</code> too.</li>
<li class="">The <code>build.sh</code> and <code>bld.bat</code> scripts are only automatically used for the top-level package. Consider using other file names for the scripts in the outputs. See <a href="https://github.com/conda-forge/gdal-feedstock/blob/66ba0a2284476/recipe/meta.yaml#L70-L73" target="_blank" rel="noopener noreferrer" class="">gdal-feedstock</a> for an example.</li>
<li class="">The <code>outputs[].script</code> field can only be set to a script name. If you prefer passing shell commands, you have to use <code>outputs[].build.script</code>. Compare <a href="https://github.com/conda-forge/geopandas-feedstock/blob/8b985635a8538af1ee213900bd563085e3cdbd92/recipe/meta.yaml#L17" target="_blank" rel="noopener noreferrer" class="">geopandas-feedstock</a> to <a href="https://github.com/conda-forge/gym-feedstock/blob/2b47e0479923b7d49a39e9860ba30a28e263480b/recipe/meta.yaml#L31" target="_blank" rel="noopener noreferrer" class="">gym-feedstock</a>, respectively.</li>
<li class="">Some <code>PIP_*</code> environment variables that are usually set for the top-level scripts are not automatically set for the outputs. If you are invoking <code>pip</code> in an output, you may need to pass additional flags. See <a href="https://github.com/conda-forge/napari-feedstock/blob/32a4eb04ca7b6ccd2c4e146bde204f1dd5425a17/recipe/meta.yaml#L26" target="_blank" rel="noopener noreferrer" class="">napari-feedstock</a>. This issue is tracked in <a href="https://github.com/conda/conda-build/issues/3993" target="_blank" rel="noopener noreferrer" class="">conda/conda-build#3993</a>.</li>
</ul>
<p><a id="build-matrices" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="build-matrices">Build matrices<a href="#build-matrices" class="hash-link" aria-label="Direct link to Build matrices" title="Direct link to Build matrices" translate="no">​</a></h2>
<p>Currently, <code>python, vc, r-base</code> will create a matrix of jobs for each supported version. If <code>python</code> is only a
build dependency and not a runtime dependency (eg: build script of the package is written in Python, but the
package is not dependent on Python), use <code>build</code> section</p>
<p>Following implies that <code>python</code> is only a build dependency and no Python matrix will be created.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> some_other_package</span><br></span></code></pre></div></div>
<p>Note that <code>host</code> should be non-empty or <code>compiler</code> jinja syntax used or <code>build/merge_build_host</code> set to
True for the <code>build</code> section to be treated as different from <code>host</code>.</p>
<p>Following implies that <code>python</code> is a runtime dependency and a Python matrix for each supported Python version will be created.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python</span><br></span></code></pre></div></div>
<p><code>conda-forge.yml</code>&#x27;s build matrices is removed in conda-smithy=3. To get a build matrix,
create a <code>conda_build_config.yaml</code> file inside the recipe folder. For example, the following will give you 2
builds and you can use the selector <code>vtk_with_osmesa</code> in the <code>meta.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">vtk_with_osmesa</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">True</span><br></span></code></pre></div></div>
<p>You need to rerender the feedstock after this change.</p>
<p><a id="requiring-newer-macos-sdks" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="requiring-newer-macos-sdks">Requiring newer macOS SDKs<a href="#requiring-newer-macos-sdks" class="hash-link" aria-label="Direct link to Requiring newer macOS SDKs" title="Direct link to Requiring newer macOS SDKs" translate="no">​</a></h2>
<p>conda-forge uses macOS SDK 10.13 to build software so that they can be deployed to
all macOS versions newer than 10.13. Sometimes, some packages require a newer SDK
to build with. While the default version 10.13 can be overridden using the following
changes to the recipe, it should be done as a last resort. Please consult with
core team if this is something you think you need.</p>
<p>To use a new SDK, add the following in <code>recipe/conda_build_config.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Please consult conda-forge/core before doing this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">MACOSX_SDK_VERSION</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># [osx and x86_64]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.15&quot;</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># [osx and x86_64]</span><br></span></code></pre></div></div>
<p>Note that this should be done if the error you are getting says that a header is not
found or a macro is not defined. This will make your package compile with a newer SDK
but with <code>10.13</code> as the deployment target.
WARNING: some packages might use features from <code>10.15</code> if you do the above due to
buggy symbol availability checks. For example packages looking for <code>clock_gettime</code>
will see it as it will be a weak symbol, but the package might not have a codepath
to handle the weak symbol, in that case, you need to update the <code>c_stdlib_version</code>
(previously <code>MACOSX_DEPLOYMENT_TARGET</code>) as described below.</p>
<p>After increasing the SDK version, if you are getting an error that says that a function
is available only for macOS x.x, then do the following in <code>recipe/conda_build_config.yaml</code>,</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Please consult conda-forge/core before doing this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">c_stdlib_version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># [osx and x86_64]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.15&quot;</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># [osx and x86_64]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">MACOSX_SDK_VERSION</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># [osx and x86_64]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.15&quot;</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># [osx and x86_64]</span><br></span></code></pre></div></div>
<p>In <code>recipe/meta.yaml</code>, add the following to ensure that the user&#x27;s system is compatible.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stdlib(&quot;c&quot;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Note that the run-export on <code>__osx</code> that&#x27;s produced by the stdlib metapackages
requires <code>conda&gt;=4.8</code>.</p>
<p><a id="newer-c-features-with-old-sdk" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="newer-c-features-with-old-sdk">Newer C++ features with old SDK<a href="#newer-c-features-with-old-sdk" class="hash-link" aria-label="Direct link to Newer C++ features with old SDK" title="Direct link to Newer C++ features with old SDK" translate="no">​</a></h3>
<p>The libc++ library uses Clang availability annotations to mark certain symbols as
unavailable when targeting versions of macOS that ship with a system libc++
that do not contain them. Clang always assumes that the system libc++ is used.</p>
<p>The conda-forge build infrastructure targets macOS 10.13 and some newer C++ features
such as <code>fs::path</code> are marked as unavailable on that platform, so the build aborts:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error: </span><span class="token string" style="color:#e3116c">&#x27;path&#x27;</span><span class="token plain"> is unavailable: introduced </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> macOS </span><span class="token number" style="color:#36acaa">10.15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">note: </span><span class="token string" style="color:#e3116c">&#x27;path&#x27;</span><span class="token plain"> has been explicitly marked unavailable here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class _LIBCPP_TYPE_VIS path </span><span class="token punctuation" style="color:#393A34">{</span><br></span></code></pre></div></div>
<p>However, since conda-forge ships its own (modern) libcxx we can ignore these checks
because these symbols are in fact available. To do so, add
<code>_LIBCPP_DISABLE_AVAILABILITY</code> to the defines. For example</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">CXXFLAGS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${CXXFLAGS}</span><span class="token string" style="color:#e3116c"> -D_LIBCPP_DISABLE_AVAILABILITY&quot;</span><br></span></code></pre></div></div>
<p><a id="pypy-builds" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="pypy-builds">PyPy builds<a href="#pypy-builds" class="hash-link" aria-label="Direct link to PyPy builds" title="Direct link to PyPy builds" translate="no">​</a></h2>
<p>See <a class="" href="/docs/user/tipsandtricks/#pypy">Using PyPy as an interpreter</a> in the user docs for more info about PyPy and conda-forge.</p>
<p>To build your python package for pypy, wait for the bot to send a
PR and contact <code>conda-forge/bot</code> team if a PR is not sent after the
dependencies have been built.</p>
<p>To add a dependency just for pypy or cpython, do,</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> spam           </span><span class="token comment" style="color:#999988;font-style:italic"># [python_impl == &#x27;cpython&#x27;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ham            </span><span class="token comment" style="color:#999988;font-style:italic"># [python_impl == &#x27;pypy&#x27;]</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>You&#x27;ll need to rerender the feedstocks after making the above
change in order for the <code>python_impl</code> variable to be available to
conda-build</p></div></div>
<p>To skip the pypy builds, do the following,</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">skip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">True</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># [python_impl == &#x27;pypy&#x27;]</span><br></span></code></pre></div></div>
<p>If something is failing the PyPy build when it passes the CPython one, reach
out to @conda-forge/help-pypy.</p>
<p><a id="using-setuptools-scm" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-setuptools_scm">Using setuptools_scm<a href="#using-setuptools_scm" class="hash-link" aria-label="Direct link to Using setuptools_scm" title="Direct link to Using setuptools_scm" translate="no">​</a></h2>
<p>The Python module <a href="https://github.com/pypa/setuptools_scm" target="_blank" rel="noopener noreferrer" class="">setuptools_scm</a>
can be used to manage a package&#x27;s version automatically from metadata, such as git tags.
The package&#x27;s version string is thus not specified anywhere in the package,
but encoded in it at install-time.</p>
<p>For conda-build this means that <code>setuptools_scm</code> must be included as a <code>host</code> dependency.
Additionally, some attention because the metadata is often not available in the sources.
There are two options for how to proceed:</p>
<ul>
<li class="">For Python package also available on PyPI:
Use the PyPi tarball as a source, as it will have the metadata encoded
(in such a way that <code>setuptools_scm</code> knows how to find it).</li>
<li class="">Specify the environment variable <code>SETUPTOOLS_SCM_PRETEND_VERSION</code> with the version string.
If specified this environment variable is the principle source for <code>setuptools_scm</code>.
There are two ways how to do this:
<ul>
<li class="">
<p>If you are using build scripts, in <code>build.sh</code> specify:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">SETUPTOOLS_SCM_PRETEND_VERSION</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$PKG_VERSION</span><span class="token string" style="color:#e3116c">&quot;</span><br></span></code></pre></div></div>
<p>and in <code>bld.bat</code> specify:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">SETUPTOOLS_SCM_PRETEND_VERSION</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">%PKG_VERSION%</span><br></span></code></pre></div></div>
<p>Whereby you use that <code>PKG_VERSION</code> has been set with the version string,
see <a href="https://docs.conda.io/projects/conda-build/en/stable/user-guide/environment-variables.html#env-vars" target="_blank" rel="noopener noreferrer" class="">Environment variables</a>.</p>
</li>
<li class="">
<p>Otherwise, if you are directly building from <code>meta.yaml</code>, use for example:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [...]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script_env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> SETUPTOOLS_SCM_PRETEND_VERSION=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ PYTHON }} -m pip install . -vv&quot;</span><br></span></code></pre></div></div>
</li>
</ul>
</li>
</ul>
<p><a id="centos7" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="using-centos-7" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="requiring-newer-glibc-versions">Requiring newer <code>glibc</code> versions<a href="#requiring-newer-glibc-versions" class="hash-link" aria-label="Direct link to requiring-newer-glibc-versions" title="Direct link to requiring-newer-glibc-versions" translate="no">​</a></h2>
<p>Conda-forge aims to build for as many users as possible, which means
that we target <code>glibc 2.17</code> from CentOS 7, which allows packages to be
installed on essentially any linux system (newer than 2014).</p>
<p>However, some feedstocks may already require newer <code>glibc</code> versions.
To use the newer <code>sysroot</code> with <code>glibc</code> <code>2.28</code> or <code>2.34</code> on <code>linux</code>,
put the following in your build section.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">requirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> compiler(&#x27;c&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stdlib(&#x27;c&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>and add the following to <code>recipe/conda_build_config.yaml</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">c_stdlib_version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># [linux]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2.28&quot;</span><span class="token plain">                 </span><span class="token comment" style="color:#999988;font-style:italic"># [linux]</span><br></span></code></pre></div></div>
<p>This covers the headers/library present at build-time, and will also create
a corresponding run-export on the <code>__glibc</code> virtual package.</p>
<p>By default, conda-forge build infrastructure uses old sysroots on new images, meaning that
the <code>glibc</code> present in the docker image is not what we compile against. This has
several advantages, and also means that generally you don&#x27;t have to concern
yourself with changing the image manually.</p>
<p>However, if for some reason you want to override the image versions, you can do so
by setting the following in the <code>conda-forge.yml</code> of your recipe and rerendering.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">os_version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic"># example of possible values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">linux_64</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cos7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">linux_aarch64</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> alma8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">linux_ppc64le</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> alma9</span><br></span></code></pre></div></div>
<p>In the exceptional case that a feedstock does <em>binary repackaging</em> (i.e. no
compilation from source), please ensure that you use the oldest-possible image,
matching the <code>c_stdlib_version</code> of your recipe. For example, if you use the
default <code>c_stdlib_version</code> of <code>2.17</code>, then set <code>os_version: linux_*: cos7</code>;
if you&#x27;re using a <code>c_stdlib_version</code> of <code>2.28</code>, set it to <code>alma8</code>.</p>
<p><a id="cuda" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="cuda-builds" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="cuda-builds">CUDA builds<a href="#cuda-builds" class="hash-link" aria-label="Direct link to CUDA builds" title="Direct link to CUDA builds" translate="no">​</a></h2>
<p>Although the provisioned CI machines do not feature a GPU, conda-forge does provide mechanisms
to build CUDA-enabled packages.
See the <a href="https://github.com/conda-forge/cuda-feedstock/blob/main/recipe/doc/recipe_guide.md" target="_blank" rel="noopener noreferrer" class="">guide for maintainers of recipes that use CUDA</a>
for more information.
If a feedstock does need access to additional resources (like GPUs), please see the following
<a href="#packages-that-require-a-gpu-or-long-running-builds" class="">section</a>.</p>
<p><a id="common-problems-and-known-issues" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-problems-and-known-issues">Common problems and known issues<a href="#common-problems-and-known-issues" class="hash-link" aria-label="Direct link to Common problems and known issues" title="Direct link to Common problems and known issues" translate="no">​</a></h3>
<p><a id="nvcuda-dll-cannot-be-found-on-windows" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="nvcudadll-cannot-be-found-on-windows"><code>nvcuda.dll</code> cannot be found on Windows<a href="#nvcudadll-cannot-be-found-on-windows" class="hash-link" aria-label="Direct link to nvcudadll-cannot-be-found-on-windows" title="Direct link to nvcudadll-cannot-be-found-on-windows" translate="no">​</a></h4>
<p>The <a href="https://github.com/conda-forge/conda-forge-ci-setup-feedstock/blob/main/recipe/install_cuda.bat" target="_blank" rel="noopener noreferrer" class="">scripts</a>
used to install the CUDA Toolkit on Windows cannot provide <code>nvcuda.dll</code>
as part of the installation because no GPU is physically present in the CI machines.
As a result, you might get linking errors in the postprocessing steps of <code>conda build</code>:</p>
<div class="language-default codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-default codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">WARNING (arrow-cpp,Library/bin/arrow_cuda.dll): $RPATH/nvcuda.dll not found in packages,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sysroot(s) nor the missing_dso_whitelist.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.. is this binary repackaging?</span><br></span></code></pre></div></div>
<p>For now, you will have to add <code>nvcuda.dll</code> to the <code>missing_dso_whitelist</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">missing_dso_whitelist</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*/nvcuda.dll&quot;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># [win]</span><br></span></code></pre></div></div>
<p><a id="my-feedstock-is-not-building-old-cuda-versions-anymore" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="my-feedstock-is-not-building-old-cuda-versions-anymore">My feedstock is not building old CUDA versions anymore<a href="#my-feedstock-is-not-building-old-cuda-versions-anymore" class="hash-link" aria-label="Direct link to My feedstock is not building old CUDA versions anymore" title="Direct link to My feedstock is not building old CUDA versions anymore" translate="no">​</a></h4>
<p>As new CUDA versions come out regularly, periodically conda-forge needs to
decide how many versions will be supported within resource constraints.
As of January 2025, conda-forge supports CUDA 11 and 12.</p>
<p>To update to the latest supported versions <a class="" href="/docs/maintainer/updating_pkgs/#dev-update-rerender">rerender the feedstock</a>.
There may be other fixes needed for the feedstock depending on when it was last updated.</p>
<p><a id="opengpuserver" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="packages-that-require-a-gpu-or-long-running-builds" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="packages-that-require-a-gpu-or-long-running-builds">Packages that require a GPU or long-running builds<a href="#packages-that-require-a-gpu-or-long-running-builds" class="hash-link" aria-label="Direct link to Packages that require a GPU or long-running builds" title="Direct link to Packages that require a GPU or long-running builds" translate="no">​</a></h2>
<p>conda-forge has access to <a href="https://github.com/Quansight/open-gpu-server" target="_blank" rel="noopener noreferrer" class="">an OpenStack server</a> that provides GPU builds and long-running builds (beyond the usual 6h limit).
If your package needs a GPU to be built or tested, or its compilation times are so long that they are currently done manually off-CI, you can request access to these runners.
To do so:</p>
<ol>
<li class="">Open a PR in <a href="https://github.com/conda-forge/admin-requests" target="_blank" rel="noopener noreferrer" class="">conda-forge/admin-requests</a>. Follow the instructions in the repository README.
Note you need to request the type of resource you want access to (e.g. GPU runners, or long-running CPU builds)
Once merged, this will enable the self-hosted Github Actions runners for your feedstock.</li>
<li class="">In order to trigger jobs for these runners, the maintainer must have read and agreed to the open-gpu-server <a href="https://github.com/Quansight/open-gpu-server/blob/main/TOS.md" target="_blank" rel="noopener noreferrer" class="">terms of use</a>.
You will need to open a PR in the open-gpu-server repository, as instructed in their README.
You only need to do this once per maintainer (e.g. if you maintain multiple feedstocks).</li>
<li class="">Finally, you can configure your feedstock to use the self-hosted runners. A PR will have been created by admin-requests after the PR in step (1) is merged.
However, due to security measurements imposed by Github, automated re-rendering is not possible when they modify Github Actions workflows.
You will need to rerender it manually by running <code>conda-smithy rerender</code> in your machine and then commit and push the result.</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Due to some technical and legal limitations, some of the usual automation infrastructure is not available for these runners.
As mentioned above, the conda-forge bots won&#x27;t be able to rerender your feedstock automatically anymore.
Automerge will not function properly either. Also note that the conda-forge bots won&#x27;t be able to trigger the self-hosted runners.
Closing and reopening the PR won&#x27;t work, but a maintainer with sufficient permissions can trigger it manually by pushing an empty commit.</p></div></div>
<p><a id="osxarm64" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="apple-silicon-builds" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="apple-silicon-builds">Apple Silicon builds<a href="#apple-silicon-builds" class="hash-link" aria-label="Direct link to Apple Silicon builds" title="Direct link to Apple Silicon builds" translate="no">​</a></h2>
<p>The new Apple M1 processor is the first Apple Silicon supported by conda-forge
<a href="https://github.com/conda-forge/conda-forge.github.io/issues/1126" target="_blank" rel="noopener noreferrer" class="">osx-arm64</a> builds.
For new builds to be available, via <a href="#cross-compilation" class="">cross-compilation</a>, a migration is required for
the package and its dependencies. These builds are experimental as many of them are untested.</p>
<p>To request a migration for a particular package and all its dependencies:</p>
<ol>
<li class="">It may be that your package is already in the process of being migrated. Please check
the status of the
<a href="https://conda-forge.org/status/#armosxaddition" target="_blank" rel="noopener noreferrer" class="">arm osx addition migration</a>.
If your package is already in the process of being migrated, it will appear
under the appropriate heading (done, in-pr, awaiting-parents, etc.).</li>
<li class="">Check the feedstock in question to see if there is already an issue or pull request.
Opening an issue here is fine, as it might take a couple iterations of the below,
especially if many dependencies need to be built as well.</li>
<li class="">If nothing is under way, look at the current <a href="https://github.com/conda-forge/conda-forge-pinning-feedstock/blob/main/recipe/migration_support/osx_arm64.txt" target="_blank" rel="noopener noreferrer" class="">conda-forge-pinning</a>.</li>
<li class="">If the package is not listed there, make a PR, adding the package
name to <code>osx_arm64.txt</code> (preserving the alphabetical ordering).
The migration bot should start making automated pull requests to the
repo and its dependencies.</li>
<li class="">Within a few hours, the <a href="https://conda-forge.org/status/#armosxaddition" target="_blank" rel="noopener noreferrer" class="">status page</a>
should reflect the progress of the package in question, and help you keep track
of progress. Help out if you can!</li>
<li class="">The feedstock maintainers (who might not have an M1) will work to make
any changes required to pass continuous integration. If you have insight into
the particular package, <strong>please</strong> chime in, but most of all <strong>be patient and polite</strong>.</li>
<li class="">Once the new builds are available from <code>anaconda.org</code>, please help the maintainers
by testing the packages, and reporting back with any problems… but also successes!</li>
</ol>
<p><a id="pre-release-builds" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="pre-release-builds">Pre-release builds<a href="#pre-release-builds" class="hash-link" aria-label="Direct link to Pre-release builds" title="Direct link to Pre-release builds" translate="no">​</a></h2>
<p>Recipe maintainers can make pre-release builds available on
conda-forge by adding them to the <code>dev</code> or <code>rc</code> label.</p>
<p>The semantics of these labels should generally follow the
<a href="https://devguide.python.org/developer-workflow/development-cycle/index.html#stages" target="_blank" rel="noopener noreferrer" class="">guidelines</a> that Python
itself follows.</p>
<ul>
<li class=""><code>rc</code>: <a href="https://devguide.python.org/developer-workflow/development-cycle/index.html#beta" target="_blank" rel="noopener noreferrer" class="">Beta</a> and <a href="https://devguide.python.org/developer-workflow/development-cycle/index.html#release-candidate-rc" target="_blank" rel="noopener noreferrer" class="">Release
Candidate</a>
(RC). No new features. Bugfix only.</li>
<li class=""><code>dev</code>: <a href="https://devguide.python.org/developer-workflow/development-cycle/index.html#pre-alpha" target="_blank" rel="noopener noreferrer" class="">Pre-Alpha</a>
and <a href="https://devguide.python.org/developer-workflow/development-cycle/index.html#alpha" target="_blank" rel="noopener noreferrer" class="">Alpha</a>. These are
still packages that could see substantial changes
between the dev version and the final release.</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><code>alpha</code> and <code>beta</code> labels aren&#x27;t used. Given the light usage of labels on the conda-forge
channel thus far, it seems rather unnecessary to introduce many labels.
<code>dev</code> and <code>rc</code> seem like a nice compromise.</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Certain packages (for example <a href="https://pypi.org/project/black/#history" target="_blank" rel="noopener noreferrer" class="">black</a>) follow
a release cycle in which they have never had a non-beta/alpha release. In these cases
the conda packages for those do <em>not</em> need to be published to a prerelease label.</p></div></div>
<p><a id="creating-a-pre-release-build" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="creating-a-pre-release-build">Creating a pre-release build<a href="#creating-a-pre-release-build" class="hash-link" aria-label="Direct link to Creating a pre-release build" title="Direct link to Creating a pre-release build" translate="no">​</a></h3>
<p>To create a <code>dev</code> or <code>rc</code> package, a PR can be issued into the <code>dev</code> or <code>rc</code> branch of the
feedstock.
This branch must change the <code>recipe/conda_build_config.yaml</code> file to point to the <code>&lt;package_name&gt;_dev</code> or <code>&lt;package_name&gt;_rc</code> label.</p>
<p>For example, matplotlib rc releases would include:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">channel_targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge matplotlib_rc</span><br></span></code></pre></div></div>
<p>If a pre-release build of B depends on a pre-release build of A, then A should have,</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">channel_targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge A_rc</span><br></span></code></pre></div></div>
<p>while B should have,</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">channel_sources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge/label/A_rc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">channel_targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge B_rc</span><br></span></code></pre></div></div>
<p>in <code>recipe/conda_build_config.yaml</code> in their respective feedstocks.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>A rerender needs to happen for these changes to reflect in CI files. The channel_targets entries map</p><ul>
<li class=""><channel target=""> <label target=""> pairs for use in the post-build upload step.</label></channel></li>
</ul></div></div>
<p><a id="installing-a-pre-release-build" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="installing-a-pre-release-build">Installing a pre-release build<a href="#installing-a-pre-release-build" class="hash-link" aria-label="Direct link to Installing a pre-release build" title="Direct link to Installing a pre-release build" translate="no">​</a></h3>
<p><a id="using-the-conda-cli" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-the-conda-cli">Using the conda CLI<a href="#using-the-conda-cli" class="hash-link" aria-label="Direct link to Using the conda CLI" title="Direct link to Using the conda CLI" translate="no">​</a></h4>
<p>Use the following command, but replace <code>PACKAGE_NAME</code> with the package you want
to install and replace <code>LABEL</code> with <code>rc</code> or <code>dev</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda install </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge/label/PACKAGE_NAME_LABEL </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge PACKAGE_NAME</span><br></span></code></pre></div></div>
<p>For example, let&#x27;s install matplotlib from the <code>rc</code> label:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda install </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge/label/matplotlib_rc </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge matplotlib</span><br></span></code></pre></div></div>
<p><a id="using-environment-yml" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-environmentyml">Using environment.yml<a href="#using-environmentyml" class="hash-link" aria-label="Direct link to Using environment.yml" title="Direct link to Using environment.yml" translate="no">​</a></h4>
<p>Use <a href="https://github.com/conda/conda/blob/c3fb8150ed4c3dabb7ca376ade208095f98ee0b9/conda/models/match_spec.py#L70-L150" target="_blank" rel="noopener noreferrer" class="">MatchSpec</a>
to specify your package:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">dependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge/label/matplotlib_rc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">matplotlib=3.7.0rc1</span><br></span></code></pre></div></div>
<p>Alternately, you can use the channels section to enable the matplotlib_rc channel:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">channels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forge/label/matplotlib_rc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> matplotlib=3.7.0.rc1</span><br></span></code></pre></div></div>
<p><a id="pre-release-version-sorting" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pre-release-version-sorting">Pre-release version sorting<a href="#pre-release-version-sorting" class="hash-link" aria-label="Direct link to Pre-release version sorting" title="Direct link to Pre-release version sorting" translate="no">​</a></h3>
<p>If you wish to add numbers to your <code>dev</code> or <code>rc</code> build, you should follow the
<a href="https://docs.conda.io/projects/conda/en/stable/user-guide/concepts/pkg-specs.html#version-ordering" target="_blank" rel="noopener noreferrer" class="">guidelines</a> put
forth by Continuum regarding version sorting in <code>conda</code>. Also see the <a href="https://github.com/conda/conda/blob/4.2.13/conda/version.py#L93-L119" target="_blank" rel="noopener noreferrer" class="">source
code for conda
4.2.13</a>.
The tl;dr here is that conda sorts as follows:</p>
<div class="language-default codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-default codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt; 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; 1.1dev1    # special case &#x27;dev&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; 1.1.0dev1  # special case &#x27;dev&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">== 1.1.dev1   # 0 is inserted before string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; 1.1.0rc1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; 1.1.0</span><br></span></code></pre></div></div>
<p>So make sure that you <strong>tag</strong> your package in such a way that the package name
that conda-build spits out will sort the package uploaded with an <code>rc</code> label
higher than the package uploaded with the <code>dev</code> label.</p>
<p><a id="how-to-update-your-feedstock-token" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-update-your-feedstock-token">How to update your feedstock token?<a href="#how-to-update-your-feedstock-token" class="hash-link" aria-label="Direct link to How to update your feedstock token?" title="Direct link to How to update your feedstock token?" translate="no">​</a></h2>
<p>To reset your feedstock token and fix issues with uploads, follow these steps:</p>
<ol>
<li class="">Go to the <code>conda-forge/admin-requests</code> repo and copy <a href="https://github.com/conda-forge/admin-requests/blob/main/examples/example-token-reset.yml" target="_blank" rel="noopener noreferrer" class="">examples/example-token-reset.yml</a> to the <code>requests/</code> folder.</li>
<li class="">Add the name of your feedstock in the YML file. While adding the name, don&#x27;t add &quot;-feedstock&quot; to the end of it. For example: for <code>python-feedstock</code>, just add <code>python</code>.</li>
</ol>
<p><a id="using-arch-rebuild" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="using-arch-rebuild-txt" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-arch_rebuildtxt">Using <code>arch_rebuild.txt</code><a href="#using-arch_rebuildtxt" class="hash-link" aria-label="Direct link to using-arch_rebuildtxt" title="Direct link to using-arch_rebuildtxt" translate="no">​</a></h2>
<p>You can add a feedstock to <code>arch_rebuild.txt</code> if it requires rebuilding with different architectures/platforms (such as <code>ppc64le</code> or <code>aarch64</code>).
Check the <a href="https://conda-forge.org/status/#aarch64andppc64leaddition" target="_blank" rel="noopener noreferrer" class="">migration status</a> to see if your package is already in the queue to get migrated.
If not, you can add the feedstock to <a href="https://github.com/conda-forge/conda-forge-pinning-feedstock/blob/main/recipe/migration_support/arch_rebuild.txt" target="_blank" rel="noopener noreferrer" class=""><code>arch_rebuild.txt</code></a>
by opening a PR to the <a href="https://github.com/conda-forge/conda-forge-pinning-feedstock" target="_blank" rel="noopener noreferrer" class="">conda-forge-pinning-feedstock repository</a>.
Once the PR is merged, the migration bot goes through the list of feedstocks in <code>arch_rebuild.txt</code> and opens a migration PR for any new feedstocks and their dependencies, enabling the aarch64/ppc64le builds.</p>
<p><a id="migrations-and-migrators" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<p><a id="migrators-and-migrations" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="migrators-and-migrations">Migrators and Migrations<a href="#migrators-and-migrations" class="hash-link" aria-label="Direct link to Migrators and Migrations" title="Direct link to Migrators and Migrations" translate="no">​</a></h2>
<p>When any changes are made in the global pinnings of a package, then the entire stack of the packages that need that package on their <code>host</code> section would need to be updated and rebuilt.
Doing it manually can be quite tedious, and that&#x27;s where migrations come to help. Migrations automate the process of submitting changes to a feedstock and are an integral part of the <code>regro-cf-autotick-bot</code>&#x27;s duties.</p>
<p>There are several kinds of migrations, which you can read about in <a href="https://github.com/regro/cf-scripts/blob/main/README.md#making-migrators" target="_blank" rel="noopener noreferrer" class="">Making Migrators</a>. To generate these migrations, you use migrators, which are bots that automatically create pull requests for the affected packages in conda-forge.
To propose a migration in one or more pins, the migrator issues a PR into the pinning feedstock using a yaml file expressing the changes to the global pinning file in the migrations folder.
Once the PR is merged, the dependency graph is built. After that, the bot walks through the graph, migrates all the nodes (feedstocks) one by one, and issues PRs for those feedstocks.</p>
<p>Usually, the bot generates these migrations automatically. However, when a pin is first made or added, one may need to be added by hand. To do this, you can follow the steps mentioned in <a class="" href="/docs/maintainer/pinning_deps/#update-pins">Updating package pins</a>.</p>
<p>The way migrations proceed are:</p>
<blockquote>
<ol>
<li class="">You make a PR into the <code>migrations</code> folder in the <a href="https://github.com/conda-forge/conda-forge-pinning-feedstock" target="_blank" rel="noopener noreferrer" class="">conda-forge-pinning-feedstock</a> with a new yaml file representing the migration.</li>
<li class="">Once the PR is merged, the bot picks it up, builds a migrator graph, and begins the migration process.</li>
<li class="">A migration PR is issued for a node (a feedstock) only if:</li>
</ol>
</blockquote>
<blockquote>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- The node depends on the changed pinnings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- The node has no dependencies that depend on the new pinnings and have not been migrated.</span><br></span></code></pre></div></div>
<ol>
<li class="">Process 3 continues until the migration is complete and the change is applied to the global pinning file via a final PR. After this step, we say this migration is closed out.</li>
</ol>
</blockquote>
<p>Sometimes, you might get a migration PR for your package that you don&#x27;t want to merge. In that case, you should put that PR in draft status but should never close it.
If you close the PR, it makes the bot think that another PR implementing the migration is merged instead, letting the migration continue iterating on the graph; however, the downstream dependents fail because the parent (the one we closed the PR of) didn&#x27;t really get rebuilt.
Another reason why it is good to keep the PR open or in draft status is that people might help with it if they want in the future.</p>
<p>In some cases a migration PR may not get opened. Please look for
<a href="https://conda-forge.org/status/#big_migrations" target="_blank" rel="noopener noreferrer" class="">the migration on our status page</a>
to see if there are any issues. This may show there are still dependencies
needing migration, in which case the best approach is to wait (or if possible
offer to help migrate those dependencies). If there is a bot error, there will
be a link to the CI job to provide more details about what may have gone wrong.
In these cases <a href="http://github.com/regro/cf-scripts/issues/new" target="_blank" rel="noopener noreferrer" class="">please raise an issue</a>
and include as much information as possible.</p>
<p>It is worth noting that one also has the option to create a migration PR
themselves. This can be a good option if the bot errored and that is still
being investigated or the migration PR got closed accidentally. To migrate a PR manually:</p>
<blockquote>
<ol>
<li class="">Fork the feedstock and clone it locally</li>
<li class="">Create a new branch</li>
<li class="">Create the directory <code>.ci_support/migrations</code> in the feedstock (if absent)</li>
<li class="">Copy the migrator from <a href="https://github.com/conda-forge/conda-forge-pinning-feedstock/tree/main/recipe/migrations" target="_blank" rel="noopener noreferrer" class="">conda-forge-pinning&#x27;s migrators</a> to <code>.ci_support/migrations</code> and commit it</li>
<li class=""><a class="" href="/docs/maintainer/updating_pkgs/#dev-update-rerender">Rerender</a> the feedstock</li>
<li class="">Push these changes and open a PR</li>
</ol>
</blockquote>
<p><a id="security-considerations-for-conda-forge-builds" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="security-considerations-for-conda-forge-builds">Security considerations for conda-forge builds<a href="#security-considerations-for-conda-forge-builds" class="hash-link" aria-label="Direct link to Security considerations for conda-forge builds" title="Direct link to Security considerations for conda-forge builds" translate="no">​</a></h2>
<p>All conda-forge packages are built by strangers on the internet on public cloud infrastructure from source code you likely have not inspected, so you should not use conda-forge packages if you or your team require a high level of security.
You are also free to download recipes and rebuild them yourself, if you would like at least that much oversight. However, many people use conda-forge all the time with no issues and here are some things that conda-forge does to help with security in some ways:</p>
<ol>
<li class=""><a class="" href="/docs/maintainer/adding_pkgs/#meta-yaml-source">Sources</a> (where you specify where the package&#x27;s source code is coming from) can be pulled from GitHub, PyPI, or other sources and sha256 hashes are always used, so moving of tags or uploading of new sdists can not cause automatic package rebuilds.
Also, once packages are accepted and made into feedstocks, only the maintainers of that feedstock have the right to merge PRs made to that feedstock.</li>
<li class="">Each feedstock can only upload packages for that feedstock. This is enforced by using a cf-staging channel where builds are first sent.
A bot then assesses that the submitting feedstock has permission to build the package it has submitted, and only then will it relay the build to the <code>conda-forge</code> channel.
This helps mitigate against a bad actor gaining access to an inconspicuous feedstock and then trying to push a build with malicious code into essential infrastructure packages (e.g., OpenSSL or Python).</li>
<li class="">We have <a href="https://github.com/conda-forge/artifact-validation" target="_blank" rel="noopener noreferrer" class="">artifact-validation</a> for validating all the conda-forge artifacts uploaded to <code>anaconda.org</code>. This validation scans for various security-related items, such as artifacts that overwrite key pieces of certain packages.</li>
<li class="">We have a dedicated <a class="" href="/community/subteams/#security-subteam">Security and Systems Sub-Team</a> who works hard towards making sure to secure and maintain appropriate access to the credentials and services/systems used by conda-forge.</li>
</ol>
<p>If you have found a security-related issue with conda-forge, please check our <a href="https://github.com/conda-forge/conda-forge.github.io/security/policy" target="_blank" rel="noopener noreferrer" class="">Security Policy</a>
to learn how to report it responsibly.</p>
<p><a id="significant-changes-to-upstream-projects" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="significant-changes-to-upstream-projects">Significant Changes To Upstream Projects<a href="#significant-changes-to-upstream-projects" class="hash-link" aria-label="Direct link to Significant Changes To Upstream Projects" title="Direct link to Significant Changes To Upstream Projects" translate="no">​</a></h2>
<p>From time to time, we make changes in upstream projects so that they better integrate into the conda-forge ecosystem. We
have listed some, but not all, of those changes here for specific projects along with any associated documentation.</p>
<p><a id="python" class="anchorTargetStickyNavbar_Vzrq"></a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="python">Python<a href="#python" class="hash-link" aria-label="Direct link to Python" title="Direct link to Python" translate="no">​</a></h3>
<p>We carry an extensive set of python patches that change some core behaviors around search paths, environment isolation
in conda environments, and some operating system limits. See the <a href="https://github.com/conda-forge/python-feedstock" target="_blank" rel="noopener noreferrer" class="">python feedstock</a> for more details.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/conda-forge/conda-forge.github.io/tree/refs/heads/main/docs/maintainer/knowledge_base.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-12-11T00:13:40.000Z" itemprop="dateModified">Dec 11, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/maintainer/conda_forge_yml/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Configuring conda-forge.yml</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/maintainer/maintainer_faq/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FAQ</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#search-github" class="table-of-contents__link toc-highlight">Finding examples with Github Code Search</a></li><li><a href="#using-cmake" class="table-of-contents__link toc-highlight">Using CMake</a><ul><li><a href="#moving-from-an-autotools-build-to-a-cmake-build" class="table-of-contents__link toc-highlight">Moving from an autotools build to a CMake build</a></li></ul></li><li><a href="#particularities-on-windows" class="table-of-contents__link toc-highlight">Particularities on Windows</a><ul><li><a href="#local-testing" class="table-of-contents__link toc-highlight">Local testing</a></li><li><a href="#notes-on-native-code" class="table-of-contents__link toc-highlight">Notes on native code</a></li><li><a href="#tips--tricks-for-cmdbatch-syntax" class="table-of-contents__link toc-highlight">Tips &amp; tricks for CMD/Batch syntax</a></li><li><a href="#building-packages-using-configure-scripts-written-in-shell-script" class="table-of-contents__link toc-highlight">Building packages using configure scripts written in shell script</a></li><li><a href="#install-paths-and-naming-conventions" class="table-of-contents__link toc-highlight">Install paths and naming conventions</a></li></ul></li><li><a href="#special-dependencies-and-packages" class="table-of-contents__link toc-highlight">Special Dependencies and Packages</a><ul><li><a href="#compilers" class="table-of-contents__link toc-highlight">Compilers</a></li><li><a href="#cross-compilation" class="table-of-contents__link toc-highlight">Cross-compilation</a></li><li><a href="#emulated-builds" class="table-of-contents__link toc-highlight">Emulated builds</a></li><li><a href="#rust-nightly" class="table-of-contents__link toc-highlight">Rust Nightly</a></li><li><a href="#core-dependency-tree-packages-cdts" class="table-of-contents__link toc-highlight">Core Dependency Tree Packages (CDTs)</a></li><li><a href="#libgl" class="table-of-contents__link toc-highlight">libGL</a></li><li><a href="#building-against-numpy" class="table-of-contents__link toc-highlight">Building Against NumPy</a></li><li><a href="#jupyterlab-extensions" class="table-of-contents__link toc-highlight">JupyterLab Extensions</a></li><li><a href="#message-passing-interface-mpi" class="table-of-contents__link toc-highlight">Message passing interface (MPI)</a></li><li><a href="#openmp" class="table-of-contents__link toc-highlight">OpenMP</a></li><li><a href="#yum_requirementstxt" class="table-of-contents__link toc-highlight">yum_requirements.txt</a></li><li><a href="#blas" class="table-of-contents__link toc-highlight">BLAS</a></li><li><a href="#microarch" class="table-of-contents__link toc-highlight">Microarchitecture-optimized builds</a></li><li><a href="#matplotlib" class="table-of-contents__link toc-highlight">Matplotlib</a></li><li><a href="#pybind11-and-swig-abi-constraints" class="table-of-contents__link toc-highlight"><code>pybind11</code> and <code>swig</code> ABI Constraints</a></li><li><a href="#empty-python-packages" class="table-of-contents__link toc-highlight">Empty Python packages</a></li><li><a href="#non-version-specific-python-packages" class="table-of-contents__link toc-highlight">Non-version-specific Python packages</a></li><li><a href="#packages-with-abi3-extensions" class="table-of-contents__link toc-highlight">Packages with abi3 extensions</a></li></ul></li><li><a href="#noarch-builds" class="table-of-contents__link toc-highlight">Noarch builds</a><ul><li><a href="#noarch-python" class="table-of-contents__link toc-highlight">Noarch python</a></li><li><a href="#noarch-generic" class="table-of-contents__link toc-highlight">Noarch generic</a></li></ul></li><li><a href="#multi-output-recipes" class="table-of-contents__link toc-highlight">Multi-output recipes</a><ul><li><a href="#common-pitfalls-with-outputs" class="table-of-contents__link toc-highlight">Common pitfalls with <code>outputs</code></a></li></ul></li><li><a href="#build-matrices" class="table-of-contents__link toc-highlight">Build matrices</a></li><li><a href="#requiring-newer-macos-sdks" class="table-of-contents__link toc-highlight">Requiring newer macOS SDKs</a><ul><li><a href="#newer-c-features-with-old-sdk" class="table-of-contents__link toc-highlight">Newer C++ features with old SDK</a></li></ul></li><li><a href="#pypy-builds" class="table-of-contents__link toc-highlight">PyPy builds</a></li><li><a href="#using-setuptools_scm" class="table-of-contents__link toc-highlight">Using setuptools_scm</a></li><li><a href="#requiring-newer-glibc-versions" class="table-of-contents__link toc-highlight">Requiring newer <code>glibc</code> versions</a></li><li><a href="#cuda-builds" class="table-of-contents__link toc-highlight">CUDA builds</a><ul><li><a href="#common-problems-and-known-issues" class="table-of-contents__link toc-highlight">Common problems and known issues</a></li></ul></li><li><a href="#packages-that-require-a-gpu-or-long-running-builds" class="table-of-contents__link toc-highlight">Packages that require a GPU or long-running builds</a></li><li><a href="#apple-silicon-builds" class="table-of-contents__link toc-highlight">Apple Silicon builds</a></li><li><a href="#pre-release-builds" class="table-of-contents__link toc-highlight">Pre-release builds</a><ul><li><a href="#creating-a-pre-release-build" class="table-of-contents__link toc-highlight">Creating a pre-release build</a></li><li><a href="#installing-a-pre-release-build" class="table-of-contents__link toc-highlight">Installing a pre-release build</a></li><li><a href="#pre-release-version-sorting" class="table-of-contents__link toc-highlight">Pre-release version sorting</a></li></ul></li><li><a href="#how-to-update-your-feedstock-token" class="table-of-contents__link toc-highlight">How to update your feedstock token?</a></li><li><a href="#using-arch_rebuildtxt" class="table-of-contents__link toc-highlight">Using <code>arch_rebuild.txt</code></a></li><li><a href="#migrators-and-migrations" class="table-of-contents__link toc-highlight">Migrators and Migrations</a></li><li><a href="#security-considerations-for-conda-forge-builds" class="table-of-contents__link toc-highlight">Security considerations for conda-forge builds</a></li><li><a href="#significant-changes-to-upstream-projects" class="table-of-contents__link toc-highlight">Significant Changes To Upstream Projects</a><ul><li><a href="#python" class="table-of-contents__link toc-highlight">Python</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Getting started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/user/">User docs</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/maintainer/">Maintainer docs</a></li><li class="footer__item"><a class="footer__link-item" href="/community/cfep/">CFEPs</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/diataxis/">Reorganized docs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community/">About conda-forge</a></li><li class="footer__item"><a class="footer__link-item" href="/community/governance/">Governance</a></li><li class="footer__item"><a class="footer__link-item" href="/community/minutes/">Meeting minutes</a></li><li class="footer__item"><a class="footer__link-item" href="/community/getting-in-touch/">Get in touch</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Stay up-to-date</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/news/archive/">News</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/archive/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/status/">Status</a></li><li class="footer__item"><a href="https://bsky.app/profile/conda-forge.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bluesky<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/status/">Status</a></li><li class="footer__item"><a class="footer__link-item" href="/style-guide/">Style guide</a></li><li class="footer__item"><a href="https://github.com/conda-forge" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://conda-forge.zulipchat.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Zulip<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/conda-forge" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 conda-forge · Built with Docusaurus</div></div></div></footer></div>
</body>
</html>