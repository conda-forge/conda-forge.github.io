"use strict";(self.webpackChunkcf_infra_docs=self.webpackChunkcf_infra_docs||[]).push([[15991],{82705:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"tutorials/first-recipe","title":"Generating your first recipe","description":"In this tutorial, we will generate your first recipe for a pure Python package, use a linter to","source":"@site/docs/tutorials/first-recipe.md","sourceDirName":"tutorials","slug":"/tutorials/first-recipe","permalink":"/docs/tutorials/first-recipe","draft":false,"unlisted":false,"editUrl":"https://github.com/conda-forge/conda-forge.github.io/tree/refs/heads/main/docs/tutorials/first-recipe.md","tags":[{"inline":true,"label":"tutorial","permalink":"/docs/tags/tutorial"}],"version":"current","lastUpdatedAt":1770120630000,"frontMatter":{"tags":["tutorial"]},"sidebar":"diataxis","previous":{"title":"Tutorials","permalink":"/docs/tutorials/"},"next":{"title":"How-to guides","permalink":"/docs/how-to/"}}');var s=i(74848),r=i(28453);const a={tags:["tutorial"]},o="Generating your first recipe",c={},l=[{value:"Prepare the development environment",id:"prepare-the-development-environment",level:2},{value:"Clone the staged-recipes repository",id:"clone-the-staged-recipes-repository",level:2},{value:"Generate the initial recipe",id:"generate-the-initial-recipe",level:2},{value:"Look at the recipe file",id:"look-at-the-recipe-file",level:2},{value:"Lint the recipe",id:"lint-the-recipe",level:2},{value:"Commit the changes",id:"commit-the-changes",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"generating-your-first-recipe",children:"Generating your first recipe"})}),"\n",(0,s.jsx)(n.p,{children:"In this tutorial, we will generate your first recipe for a pure Python package, use a linter to\nverify that it follows the conda-forge best practices and prepare it for initial submission."}),"\n",(0,s.jsx)(n.p,{children:"The tutorial assumes that you have a working conda installation, and are familiar with using conda\nvia a terminal."}),"\n",(0,s.jsx)(n.h2,{id:"prepare-the-development-environment",children:"Prepare the development environment"}),"\n",(0,s.jsx)(n.p,{children:"While it is largely possible to work on conda-forge packages using system tools, to provide\nconsistency we will assume here that all the needed tools are installed in a conda environment."}),"\n",(0,s.jsx)(n.p,{children:"Start a terminal with your conda installation activated. In that terminal, create a new environment\nwith the needed packages, then activate it:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"conda create -n conda-forge-dev -y conda-smithy git grayskull python\nconda activate conda-forge-dev\n"})}),"\n",(0,s.jsx)(n.p,{children:"This environment will include the following packages:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"conda-smithy"})," which is a tool for managing conda-forge feedstocks. We will be using it here to\nlint our recipe."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"git"})," is a version control system used by conda-forge. We will be using it to clone feedstocks."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"grayskull"})," is a recipe generator."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"python"})," will be used to run scripts in the recipe directory."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"clone-the-staged-recipes-repository",children:"Clone the staged-recipes repository"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.a,{href:"https://github.com/conda-forge/staged-recipes",children:"staged-recipes"})," repository is where new recipes\nfor conda-forge are contributed. While we aren't going to be contributing a new recipe, it has a\nconvenient infrastructure for testing one."]}),"\n",(0,s.jsx)(n.p,{children:"Enter a directory of your choice, clone the repository and then enter it:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git clone --depth=1 https://github.com/conda-forge/staged-recipes\ncd staged-recipes\n"})}),"\n",(0,s.jsxs)(n.p,{children:["We are using ",(0,s.jsx)(n.code,{children:"--depth=1"})," to reduce the download size and disk space consumption, as we do not need\nthe repository's history."]}),"\n",(0,s.jsx)(n.h2,{id:"generate-the-initial-recipe",children:"Generate the initial recipe"}),"\n",(0,s.jsxs)(n.p,{children:["Let's try to create a recipe for ",(0,s.jsx)(n.a,{href:"https://pypi.org/project/pylast/7.0.1/",children:"pylast 7.0.1"}),". Since it\nis a PyPI package, we can start with an automatically generated recipe. We'll need to:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Create a git branch for our work, so that the ",(0,s.jsx)(n.code,{children:"main"})," branch remains intact."]}),"\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"grayskull"})," to create the recipe."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Type in the terminal:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git checkout -b pylast\ngrayskull pypi --use-v1-format --strict-conda-forge -o recipes pylast==7.0.1\n"})}),"\n",(0,s.jsx)(n.p,{children:"Here's a quick wraparound of the arguments passed:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pypi"})," indicates that a recipe should be generated for a package from PyPI."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--use-v1-format"})," writes the recipe in v1 format (",(0,s.jsx)(n.code,{children:"recipe.yaml"}),"). v0 (",(0,s.jsx)(n.code,{children:"meta.yaml"}),") should only be used for some edge cases that don't apply here."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--strict-conda-forge"})," follows conda-forge rules more strictly."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"-o recipes"})," causes the recipe to be output into a subdirectory of ",(0,s.jsx)(n.code,{children:"recipes"})," directory."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pylast==7.0.1"})," specifies the package name and version. Normally, you'd only specify a package\nname, but we're using a specific version here to make the results more predictable."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This command will write a ",(0,s.jsx)(n.code,{children:"recipes/pylast/recipe.yaml"})," file. This file is the recipe, containing the\ninstructions for building a package."]}),"\n",(0,s.jsx)(n.h2,{id:"look-at-the-recipe-file",children:"Look at the recipe file"}),"\n",(0,s.jsxs)(n.p,{children:["Now is a good opportunity to take a look at the recipe file we've obtained. Open\n",(0,s.jsx)(n.code,{children:"recipes/pylast/recipe.yaml"})," in your favorite text editor. We will go over the YAML file section by\nsection:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"schema_version: 1\n"})}),"\n",(0,s.jsx)(n.p,{children:"This preamble indicates that this is a v1 recipe. It will always be present on top of the v1 recipe\nfiles."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"context:\n  version: 7.0.1\n  python_min: 3.10\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This section defines helper variables that can be used elsewhere in the recipe. Here two variables\nare declared: ",(0,s.jsx)(n.code,{children:"version"})," that references the current package version, and ",(0,s.jsx)(n.code,{children:"python_min"})," that specifies\nthe minimal Python version required by it, per ",(0,s.jsx)(n.a,{href:"https://github.com/conda-forge/cfep/blob/main/cfep-25.md",children:"CFEP 25"}),".\nBy defining them here, we can easily update the values\nin the future without having to modify multiple sites where they are used."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"package:\n  name: pylast\n  version: ${{ version }}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This section specifies the name and version for the package that is built from this recipe. Note\nthat we're using the ",(0,s.jsx)(n.code,{children:"version"})," variable that was defined earlier."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"source:\n  url: https://pypi.org/packages/source/p/pylast/pylast-${{ version }}.tar.gz\n  sha256: 319251236ba5c3e907232aacf1d6a7ff831f2243e85ace6ec6623a552ec2e0eb\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This section specifies how to download the source distribution to build. It specifies the URL and a\nSHA256 hash that is used to verify its authenticity. The ",(0,s.jsx)(n.code,{children:"version"})," variable is used again here; when\nyou change the version, you won't have to update both the package version and the URL."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"build:\n  number: 0\n  noarch: python\n  script: ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation\n"})}),"\n",(0,s.jsx)(n.p,{children:"Here, three important bits of information are specified:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The build number, which is a number indicating the recipe revision for a given package version. Whenever you change the recipe\nin a way that the content or metadata of what's being packaged changes (i.e. not just cosmetic things like fixing\na typo in a comment), you increment it."}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"noarch"})," key that indicates that we're building a pure Python package, and so we do not need\nto build separate packages for different conda-forge platforms and Python versions."]}),"\n",(0,s.jsxs)(n.li,{children:["The actual build command invocation. We're using the Python package manager ",(0,s.jsx)(n.code,{children:"pip"})," to build\nand install our package into the workspace. We are passing ",(0,s.jsx)(n.code,{children:"--no-deps"})," to stop ",(0,s.jsx)(n.code,{children:"pip"})," from trying\nto automatically install its dependencies (they are already preinstalled in the environment), and\n",(0,s.jsx)(n.code,{children:"--no-build-isolation"})," to make the build use our build environment rather than creating a new\none."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"requirements:\n  host:\n    - python ${{ python_min }}.*\n    - hatch-vcs\n    - hatchling >=1.27\n    - pip\n  run:\n    - python >=${{ python_min }}\n    - httpx >=0.26\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This section specifies the package's dependencies. These are split into two parts: ",(0,s.jsx)(n.code,{children:"host"}),"\ndependencies are needed to build the package, while ",(0,s.jsx)(n.code,{children:"run"})," dependencies are needed to run it once\nit's installed. In both cases, we're using the ",(0,s.jsx)(n.code,{children:"python_min"})," variable to use the same version\nconsistently across the file. Note that while we permit running the software against any Python\nno older than ",(0,s.jsx)(n.code,{children:"python_min"}),", we deliberately build it using the oldest supported version to ensure\nthat it will work with it."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"tests:\n  - python:\n      imports:\n        - pylast\n      pip_check: true\n      python_version: ${{ python_min }}.*\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This section specifies how to test the package. In this case, it performs the absolute minimum\ntesting expected of Python package: checking if ",(0,s.jsx)(n.code,{children:"pylast"})," can be imported successfully, and running\n",(0,s.jsx)(n.code,{children:"pip check"})," to verify that the needed dependencies were installed. The testing is also done using\nthe oldest Python version, to ensure that the compatibility with it remains tested."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"about:\n  summary: A Python interface to Last.fm and Libre.fm\n  license: Apache-2.0\n  license_file:\n    - LICENSE.txt\n    - COPYING\n  homepage: https://github.com/pylast/pylast\n  repository: https://github.com/pylast/pylast\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"about"})," section provides additional package information. Notably, it includes a short package\ndescription, its license information along with a list of files containing the license inside the\nsource archive, and the homepage and repository URLs."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"extra:\n  recipe-maintainers:\n    - your-name\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Finally, the ",(0,s.jsx)(n.code,{children:"extra"})," section specifies the package maintainers. It will normally contain your user\nGithub user name."]}),"\n",(0,s.jsx)(n.h2,{id:"lint-the-recipe",children:"Lint the recipe"}),"\n",(0,s.jsxs)(n.p,{children:["Now let's see if the recipe passes all quality checks. You'd usually be doing this after making and\ntesting any changes to the recipe. To do this, we're going to use the ",(0,s.jsx)(n.code,{children:"conda-smithy"})," tool. Type the\nfollowing:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"conda smithy lint --conda-forge recipes/pylast\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will perform all the basic quality checks, plus additional conda-forge quality checks, on the\nrecipe in ",(0,s.jsx)(n.code,{children:"recipes/pylast"}),". We should get a confirmation:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"recipes/pylast is in fine form\n"})}),"\n",(0,s.jsx)(n.h2,{id:"commit-the-changes",children:"Commit the changes"}),"\n",(0,s.jsx)(n.p,{children:"Now that everything is ready, let's commit the changes into the repository. To do that, type:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git add recipes/pylast/recipe.yaml\ngit commit\n"})}),"\n",(0,s.jsx)(n.p,{children:"Git will start a text editor, asking you to provide a commit message for the change. At the very\nminimum, let's say what we did:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Add a recipe for pylast package\n"})}),"\n",(0,s.jsxs)(n.p,{children:["At this point, the recipe is ready for submission. Normally, you'd fork the GitHub repository and\ncreate a pull request. However, we aren't going to be doing that now, as ",(0,s.jsx)(n.code,{children:"pylast"})," is already packaged\nin conda-forge. The submission process is described in detail in the ",(0,s.jsx)(n.a,{href:"/docs/maintainer/adding_pkgs/",children:"contributing packages\nhow-to"}),"."]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(96540);const s={},r=t.createContext(s);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);