"use strict";(self.webpackChunkcf_infra_docs=self.webpackChunkcf_infra_docs||[]).push([[59959],{67580:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>r,contentTitle:()=>t,default:()=>p,frontMatter:()=>o,metadata:()=>c,toc:()=>l});const c=JSON.parse('{"id":"maintainer/example_recipes/go","title":"Go packages","description":"If you want to package a Go package to conda-forge, you can use this recipe template:","source":"@site/docs/maintainer/example_recipes/go.md","sourceDirName":"maintainer/example_recipes","slug":"/maintainer/example_recipes/go","permalink":"/docs/maintainer/example_recipes/go","draft":false,"unlisted":false,"editUrl":"https://github.com/conda-forge/conda-forge.github.io/tree/refs/heads/main/docs/maintainer/example_recipes/go.md","tags":[],"version":"current","lastUpdatedAt":1753728321000,"frontMatter":{"title":"Go packages"},"sidebar":"docs","previous":{"title":"Example recipes","permalink":"/docs/maintainer/example_recipes/"},"next":{"title":"Rust packages","permalink":"/docs/maintainer/example_recipes/rust"}}');var s=a(74848),i=a(28453);const o={title:"Go packages"},t=void 0,r={},l=[];function d(e){const n={a:"a",code:"code",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"If you want to package a Go package to conda-forge, you can use this recipe template:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'context:\n  name: example-package\n  version: "0.1.0"\n\npackage:\n  name: ${{ name|lower }}\n  version: ${{ version }}\n\nsource:\n  url: https://github.com/example-package/${{ name }}/archive/refs/tags/v${{ version }}.tar.gz\n  sha256: 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef\n  target_directory: src\n\nbuild:\n  number: 0\n  script:\n    - cd src\n    - go-licenses save . --save_path ../library_licenses\n    - if: unix\n      then: go build -v -o $PREFIX/bin/example-package -ldflags="-s -w"\n      else: go build -v -o %LIBRARY_BIN%\\example-package.exe -ldflags="-s"\n\nrequirements:\n  build:\n    - ${{ compiler("go-nocgo") }}\n    - go-licenses\n\ntests:\n  - script: example-package -help\n  - package_contents:\n    bin:\n      - example-package\n    strict: true\n\nabout:\n  homepage: https://github.com/example-package/example-package\n  summary: Summary of the package.\n  description: |\n    Description of the package\n  license: MIT\n  license_file:\n    - src/LICENSE\n    - library_licenses/\n  documentation: https://pkg.go.dev/github.com/example-package/example-package\n  repository: https://github.com/example-package/example-package\n\nextra:\n  recipe-maintainers:\n    - LandoCalrissian\n'})}),"\n",(0,s.jsx)(n.p,{children:"This recipe template supports different features:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Package licenses of statically linked libraries."}),"\n",(0,s.jsxs)(n.li,{children:["Ensure only binary is created by using ",(0,s.jsx)(n.code,{children:"strict: true"})," in the ",(0,s.jsx)(n.code,{children:"package_contents"})," tests."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If your package requires ",(0,s.jsx)(n.code,{children:"cgo"})," instead of ",(0,s.jsx)(n.code,{children:"go-nocgo"}),", you can use ",(0,s.jsx)(n.code,{children:'${{ compiler("go-cgo") }}'})," instead to build the package. By default, the ",(0,s.jsx)(n.code,{children:"go-nocgo"})," compiler ",(0,s.jsx)(n.a,{href:"https://github.com/conda-forge/staged-recipes/blob/main/.ci_support/linux64.yaml",children:"is used"}),". Using ",(0,s.jsx)(n.code,{children:'${{ compiler("go-cgo")) }}'})," also requires ",(0,s.jsx)(n.code,{children:'${{ compiler("c") }}'})," and ",(0,s.jsx)(n.code,{children:'${{ stdlib("c") }}'})," and may require ",(0,s.jsx)(n.code,{children:'${{ compiler("cxx") }}'})," if C++ code is compiled. C/C++ build tools such as ",(0,s.jsx)(n.code,{children:"make"}),", ",(0,s.jsx)(n.code,{children:"autoconf"}),", ",(0,s.jsx)(n.code,{children:"automake"}),", ",(0,s.jsx)(n.code,{children:"libtool"})," or ",(0,s.jsx)(n.code,{children:"cmake"})," may also be needed."]}),"\n",(0,s.jsxs)(n.p,{children:["Sometimes, ",(0,s.jsx)(n.code,{children:"go-licenses"})," might fail to detect licenses for some packages. In such cases, you can manually download the license file from the official source and add ",(0,s.jsx)(n.code,{children:"--ignore github.com/bad-package/bad-package"})," to the ",(0,s.jsx)(n.code,{children:"go-licenses"})," invokation. See ",(0,s.jsx)(n.a,{href:"https://github.com/conda-forge/k9s-feedstock/blob/7929e0d86c829ba2ca172f08926f9fb7e6398247/recipe/recipe.yaml",children:"here"})," for an example."]}),"\n",(0,s.jsxs)(n.p,{children:["Some packages ship multiple binaries, in which case the ",(0,s.jsx)(n.code,{children:"go build"})," command needs to be run separately for each binary.\nIt is increasingly common for the go build command to require specifying a subdirectory, in which case the build steps would be slightly modified as shown below:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'go-licenses save ./cmd/example-package --save-path ../library_licenses\ngo build -v -o ${PREFIX}/bin/example-package -ldflags="-s -w" ./cmd/example-package\n'})}),"\n",(0,s.jsx)(n.p,{children:"Some older Go packages that are not using Go modules yet can be converted by using:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"go mod init\ngo mod tidy\n"})}),"\n",(0,s.jsx)(n.p,{children:"Additional steps maybe required depending on which Go dependency manager the project has been using."})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>t});var c=a(96540);const s={},i=c.createContext(s);function o(e){const n=c.useContext(i);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),c.createElement(i.Provider,{value:n},e.children)}}}]);