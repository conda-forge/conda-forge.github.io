"use strict";(self.webpackChunkcf_infra_docs=self.webpackChunkcf_infra_docs||[]).push([[7483],{38445:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var o=t(85893),r=t(11151);const s={authors:["core"],tags:["security"]},i="CircleCI Security Incident",a={permalink:"/blog/2023/03/12/circle-ci-security-breach",editUrl:"https://github.com/conda-forge/conda-forge.github.io/tree/main/blog/2023-03-12-circle-ci-security-breach.md",source:"@site/blog/2023-03-12-circle-ci-security-breach.md",title:"CircleCI Security Incident",description:"In early January 2023, CircleCI informed us that they had a large",date:"2023-03-12T00:00:00.000Z",formattedDate:"March 12, 2023",tags:[{label:"security",permalink:"/blog/tags/security"}],readingTime:4.045,hasTruncateMarker:!0,authors:[{name:"conda-forge/core",title:"The conda-forge core team",url:"https://github.com/orgs/conda-forge/teams/core",imageURL:"https://github.com/conda-forge.png",key:"core"}],frontMatter:{authors:["core"],tags:["security"]},unlisted:!1,prevItem:{title:"Security updates to our installers",permalink:"/blog/2023/07/13/installer-security-fixes"},nextItem:{title:"Outreachy 2022 Wrap-up Blog",permalink:"/blog/2022/08/26/outreachy-wrap-up-blog-2022"}},c={authorsImageUrls:[void 0]},d=[{value:"Our Response",id:"our-response",level:2},{value:"What did we learn?",id:"what-did-we-learn",level:2},{value:"Closing Thoughts &amp; What can you do?",id:"closing-thoughts--what-can-you-do",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["In early January 2023, CircleCI informed us that they had a large\n",(0,o.jsx)(n.a,{href:"https://circleci.com/blog/jan-4-2023-incident-report/",children:"security breach"}),"\nwhere a third party had gained access to all the environment secrets\nstored in the service. For ",(0,o.jsx)(n.code,{children:"conda-forge"}),", these secrets are the API\ntoken used to upload built packages to our staging area on\n",(0,o.jsx)(n.code,{children:"anaconda.org"})," and the unique token we generate for each feedstock. The\nfeedstock tokens are used as part of our artifact staging process to\nensure that only the maintainers of a given feedstock can upload\npackages built by that feedstock. Later in January, we were informed by\nCircleCI that their security breach started on December 19, 2022, with\nthe bulk of the secrets being exfiltrated in plain text from their\nservers a few days later. A malicious third-party with access to these\nsecrets could potentially upload compromised versions of any package on\n",(0,o.jsx)(n.code,{children:"conda-forge"}),' in a so-called "supply chain" attack.']}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"We have produced a"})," ",(0,o.jsx)(n.a,{href:"https://raw.githubusercontent.com/conda-forge/conda-forge.github.io/main/misc/circle_ci_pkgs_dec2022_breach.json",children:"list of all possibly compromised\nartifacts"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"If you use"})," ",(0,o.jsx)(n.code,{children:"conda-forge"})," ",(0,o.jsx)(n.strong,{children:"in very sensitive environments (which we\ndo not recommend!), please remove these artifacts from your system."})]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"To date, we know of no compromised artifacts in"})," ",(0,o.jsx)(n.code,{children:"conda-forge"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"API tokens for the main"})," ",(0,o.jsx)(n.code,{children:"conda-forge"})," ",(0,o.jsx)(n.strong,{children:"channel were never exposed\nand remain secure to our knowledge."})]}),"\n",(0,o.jsx)(n.h2,{id:"our-response",children:"Our Response"}),"\n",(0,o.jsx)(n.p,{children:"We took the following steps to respond to this incident."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"We immediately started a token rotation of all of our feedstock\ntokens and our staging area upload tokens as precautionary measures.\nThis token rotation hit a few bugs, but was completed as of January\n13, 2023."}),"\n",(0,o.jsxs)(n.li,{children:["We produced a census of all packages uploaded between December 19,\n2022 and January 13, 2023. This data is available for download as a\n",(0,o.jsx)(n.a,{href:"https://raw.githubusercontent.com/conda-forge/conda-forge.github.io/main/misc/circle_ci_pkgs_dec2022_breach.json",children:"JSON\nfile"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["We examined all the artifacts built during this time period for the\n",(0,o.jsx)(n.a,{href:"https://circleci.com/blog/jan-4-2023-incident-report/",children:"malicious\nfiles"})," listed\nby CicleCI. We did not find any of those files in our artifacts."]}),"\n",(0,o.jsx)(n.li,{children:"As detailed below, we have begun retooling our system for feedstock\ntokens to be more robust and enable greater flexibility in our\nresponse to incidents like this."}),"\n",(0,o.jsxs)(n.li,{children:["We have begun systematically invalidating old tokens,\ndecommissioning old bots, and minimizing permissions of our current\ntokens in order to further enhance ",(0,o.jsx)(n.code,{children:"conda-forge"}),"'s security."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Rotating all of our tokens was taken as a precautionary measure.\nUnfortunately, during this token rotation, one of our bots encountered a\nbug which resulted in us losing the tokens for a very large fraction of\nfeedstocks. This situation resulted in an extended outage that lasted\nabout five days and was resolved on January 13, 2023, when the full\ntoken rotation was completed."}),"\n",(0,o.jsx)(n.h2,{id:"what-did-we-learn",children:"What did we learn?"}),"\n",(0,o.jsx)(n.p,{children:"We learned a few things about our system for feedstock tokens and\ngeneral maintenance of our CI service integrations. We probably should\nhave known them already, but here we are."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"We used the same feedstock token across multiple CI services. This\nlimited our ability to immediately invalidate tokens associated with\na single CI service and exposed all services if any single service\nhad an incident."}),"\n",(0,o.jsx)(n.li,{children:"Our token system only allowed one valid token per feedstock. This\nlimitation means that we cannot recover from partially failed token\nresets/rotations and are subject to race conditions during the\nreset/rotation process that can cause failed package uploads."}),"\n",(0,o.jsxs)(n.li,{children:["We need to be more proactive about cleaning up deprecated/removed CI\nservices. The use of CircleCI in ",(0,o.jsx)(n.code,{children:"conda-forge"})," has been deprecated\nfor quite a while. Had we taken the time, and had the foresight, to\nremove all of our secrets from CircleCI when it was deprecated, we\ncould have avoided the security incident all together."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"We have begun retooling our system for feedstock tokens in order to fix\nthe issues identified above and allow us to have more flexibility in\nresponding to security incidents. We have also started the process of\ndecommissioning several of our old CI services. These changes will take\ntime to implement. You can follow the progress on our various public\nissue trackers."}),"\n",(0,o.jsx)(n.h2,{id:"closing-thoughts--what-can-you-do",children:"Closing Thoughts & What can you do?"}),"\n",(0,o.jsxs)(n.p,{children:["We, the ",(0,o.jsx)(n.code,{children:"conda-forge"})," core dev team, want to thank everyone for their\npatience and support as we have responded to the various security\nincidents and bugs detailed above. It goes without saying that the\npublic nature of ",(0,o.jsx)(n.code,{children:"conda-forge"}),"'s infrastructure carries risks. On the\nother hand, by being public, anyone can look and verify our artifact\nbuilds. Security for ",(0,o.jsx)(n.code,{children:"conda-forge"})," is about reducing risk, and we will\ncontinue to do our best."]}),"\n",(0,o.jsxs)(n.p,{children:["As a reminder, we do not recommend that you use ",(0,o.jsx)(n.code,{children:"conda-forge"})," in\nenvironments with sensitive information. ",(0,o.jsx)(n.code,{children:"conda-forge"}),"'s software is\nbuilt by our users and the core dev team cannot verify or guarantee that\nthis software is not malicious or has not been tampered with."]}),"\n",(0,o.jsxs)(n.p,{children:["Our best defense against security incidents in ",(0,o.jsx)(n.code,{children:"conda-forge"})," is you! Our\nfeedstock maintainers are in the best position to notice incidents and\nissues. Please responsibly report anything you find to us at\n",(0,o.jsx)(n.code,{children:"condaforge+security@gmail.com"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>i});var o=t(67294);const r={},s=o.createContext(r);function i(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);