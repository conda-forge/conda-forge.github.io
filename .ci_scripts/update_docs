#!/usr/bin/env bash

set -ex

git checkout -b new_site_content
mamba env create -f ./.ci_scripts/environment.yml
conda activate conda-forge-docs

pushd newsfeed
pip install --no-deps .
popd

python .ci_scripts/generate_html.py

# rebuild elm
# uncomment to restore search
# npm install uglify-js --global
# ./elm-compile.xsh

# build docs into docs/; preserve old README file
mv docs/README docs-README
rm -rf docs/

python .ci_scripts/generate_cfep_index.py

pushd src
make html
mv _build/html ../docs
rm -rf _build
popd

mv docs-README docs/README
